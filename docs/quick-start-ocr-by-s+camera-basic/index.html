
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>【IoT DIY レシピ】IoT カメラで計測機器のデータを可視化</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://soracom.github.io/iot-recipes/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-66865146-33"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="quick-start-ocr-by-s&#43;camera-basic"
                  title="【IoT DIY レシピ】IoT カメラで計測機器のデータを可視化"
                  environment="web"
                  feedback-link="https://soracom.jp/products/">
    
      <google-codelab-step label="IoT カメラで計測機器のデータを可視化" duration="1">
        <p>公開日: 2020年7月</p>
<p>レシピ難易度：★★★☆☆</p>
<p class="image-container"><img alt="A picture containing indoor, sitting, computer, table\n\nDescription automatically generated" style="width: 601.70px" src="img/170aa28f74848f72.png"></p>
<p>現場に行かないとわからない機器のモニター表示やホワイトボードの表記を遠隔から確認できると、生産性があがり業務間の連携も強化されます。</p>
<p>人が現場に行って確認、それを転記するオペレーションをデジタルに見える化する手段として、このレシピではIoTカメラを使ったOCRの手順をご案内します。</p>
<p>ソラコムの提供するプログラマブルなエッジ AI カメラ S+ Camera Basic を利用し、カメラに映った数字や文字を読み取ってOCR(Optical Character Recognition)によって電子データ化します。</p>
<h2 is-upgraded>全体構成</h2>
<p class="image-container"><img alt="A picture containing sitting, screen, dark, monitor\n\nDescription automatically generated" style="width: 601.93px" src="img/40c45750119ee230.png"></p>
<h2 is-upgraded>本レシピを行うために必要な時間、概算費用</h2>
<p>本レシピは以下の通りです。</p>
<ul>
<li>必要な時間: 約1時間15分</li>
<li>概算費用: 約82,000円</li>
</ul>
<p>※ 概算費用: </p>
<ul>
<li>S+ Camera Basic費用 49,800円</li>
<li>月額費用 2,200円</li>
<li>SORACOM Air, SORACOM Inventory, SORACOM Mosaic、SORACOM Harvestの各種サービスの概ねの費用 (税や送料などの付帯費用や無料枠適用は考慮しないものとしています)を含む。</li>
</ul>
<h2 is-upgraded>このコンテンツの進め方</h2>
<p>ページの内容を読み、また作業を行ったら右下の［Next］を押して次のステップへ進みます。また、［Back］を使って戻ったり、左のナビゲーションメニューでもページの移動が可能です。</p>
<p>左上の［×］を押してコンテンツを終了することができます。また、ページを開きなおすことで再開できます。ページのアドレスはブラウザの［履歴］メニューを利用してください。</p>

<aside class="warning"><p>本コンテンツは現状のままで提供され、株式会社ソラコムは、誤りがないことの保証を含め、明示であると黙示であるとを問わず、本コンテンツの記載内容につき、いかなる種類の表明も保証も行いません。</p>
<p>掲載情報の閲覧及び利用により、利用者自身、もしくは第三者が被った損害に対して、直接的、間接的を問わず、株式会社ソラコムは責任を負いかねます。</p>
<p>本コンテンツを実践する中で用意された機器、利用されたサービスについてのご質問は、それぞれの機器やサービスの提供元にお問い合わせをお願いします。機器やサービスの仕様は、本コンテンツ作成当時のものです。</p>
<p>株式会社ソラコムが提供する機器・サービスについてのご質問は、 <a href="https://soracom.jp/contact/" target="_blank">https://soracom.jp/contact/</a> をご確認の上、適切な窓口へのお問い合わせをお願いします。機器・サービスご利用前の導入相談は <a href="https://soracom.jp/contact/contactsales/" target="_blank">https://soracom.jp/contact/contactsales/</a> に、機器・サービスご利用開始後のサポートは、SORACOMユーザーコンソール内の<a href="https://soracom.zendesk.com/hc/ja/requests/" target="_blank">サポートサイトから「リクエストを送信」</a>(要ログイン)にてお問い合わせください。</p>
<p>本ドキュメントは <a href="https://github.com/googlecodelabs/tools" target="_blank">CLaaT</a> を用いて制作しています</p>
<p>Copyright (c) 2020 SORACOM, INC.</p>
</aside>



      </google-codelab-step>
    
      <google-codelab-step label="準備" duration="1">
        <p>本レシピを行うためには以下のものをご用意ください。</p>
<h2 is-upgraded>ハードウェア</h2>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>品名</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>数量</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>価格</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>購入先</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>備考</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>S+ Camera Basic</p>
</td><td colspan="1" rowspan="1"><p>1</p>
</td><td colspan="1" rowspan="1"><p>79,800円</p>
</td><td colspan="1" rowspan="1"><p><a href="https://soracom.jp/products/industrial_devices/soracom-plus-camera-basic/" target="_blank">ソラコム</a></p>
</td><td colspan="1" rowspan="1"><p>―</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>パソコン</p>
</td><td colspan="1" rowspan="1"><p>1</p>
</td><td colspan="1" rowspan="1"><p>―</p>
</td><td colspan="1" rowspan="1"><p>―</p>
</td><td colspan="1" rowspan="1"><ul>
<li>インターネット接続が可能でサイトへの接続が自由であること。</li>
<li>Google Chrome 等の最新ブラウザーが利用可能な事。</li>
</ul>
</td></tr>
</table>
<p>※ 金額はレシピ作成時となります。ソラコムで販売している金額は税抜き・送料別です。</p>
<h2 is-upgraded>その他必要なもの</h2>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>必要なもの</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>費用</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>作成方法など</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>SORACOM アカウント</p>
</td><td colspan="1" rowspan="1"><p>無料※</p>
</td><td colspan="1" rowspan="1"><p><a href="https://soracom.github.io/iot-recipes/create-account-soracom-jp/" target="_blank">SORACOM アカウントの作成 (JP)</a></p>
</td></tr>
</table>
<p>※ アカウント作成・維持の費用の料金です。</p>


      </google-codelab-step>
    
      <google-codelab-step label="S&#43; Camera Basic が届いたら" duration="10">
        <p>S+ Camera Basic にはSIM(SORACOM Air Plan-D)が内蔵されています。そのため、最初にデバイスを利用する場合、ソラコムコンソールへログインして SIM の受け取り確認を行ってください。確認が完了するとSIM管理の一覧にSIMが表示されます。</p>
<p>次に、<a href="https://dev.soracom.io/jp/start/console/#group" target="_blank">グループ作成画面</a>よりS+ Camera Basicで利用するグループを作成します。作成したグループに対して以下のサービスを有効にします。</p>
<ul>
<li><a href="https://dev.soracom.io/jp/start/metadata/" target="_blank">SORACOM Air メタデータサービス</a></li>
<li><a href="https://dev.soracom.io/jp/start/harvest/#enable" target="_blank">SORACOM Harvest</a>/<a href="https://dev.soracom.io/jp/start/harvestfiles/#enable" target="_blank">SORACOM Harvest Files</a></li>
</ul>
<p class="image-container"><img alt="A screenshot of a cell phone\n\nDescription automatically generated" style="width: 601.93px" src="img/f78c5ae39f52c25a.png"></p>
<p>先ほど作成したグループをS+ Camera Basicに割り当てるとともに、Speed classをs1.fastに変更します</p>
<p>(画像の送信に時間がかかると場合エラーになる場合があるので、s1.fastを設定してください。)</p>
<p class="image-container"><img alt="A screenshot of a computer\n\nDescription automatically generated" style="width: 601.93px" src="img/7b996fccb697acfc.png"></p>
<aside class="special"><p><strong>SORACOM の便利な使い方: SIM の「名前」機能</strong></p>
<p>SIM には「名前」を付けることができ、これで整理が可能です。特に複数の SIMをお持ちの際には、名前を付けることを強くお勧めいたします。名前の付け方は <a href="https://dev.soracom.io/jp/start/console/#name_tag" target="_blank">SIM への名前の付け方</a>をご覧ください。</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="S&#43; Camera Basic の電源を入れる" duration="10">
        <p>電源をいれて青いLEDが点滅すると、<a href="https://console.mosaic.soracom.io/" target="_blank">SORACOM Mosaic Console</a>にS+ Camera Basicが登録され、自動的にオンラインになります。</p>
<h2 is-upgraded><img style="width: 375.11px" src="img/f77703cc5a52fcb6.gif"></h2>
<p>SORACOM Mosaicコンソールにアクセスしてカメラデバイスの状態を確認しましょう。SORACOMコンソールのグローバルメニューからアクセスできます。</p>
<p class="image-container"><img style="width: 583.00px" src="img/fd944d76e8ab641f.png"></p>
<p>前述のとおり、S+ Cameraの電源を入れると自動的にデバイス登録が実行され、リストに表示されます。最初はSIMのIMSIからデバイスを見分けるのがいいでしょう。（最初は一台だけから始められると思うので、このサンプル画面のように迷うことはないかもしれませんが）</p>
<h2 is-upgraded><img style="width: 611.50px" src="img/d5c3f2a658aed2ea.png"></h2>
<p>リストに自分のカメラが表示されたら、DEVICE IDのカラムに表示されているIDのリンクをクリックすると下記のようなデバイスの詳細画面が表示されます。</p>
<p class="image-container"><img style="width: 422.94px" src="img/382ed6ad514c032f.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="S&#43; Camera Basic の動作を確認する" duration="10">
        <p><em>Device ID</em>一覧から対象のデバイスをクリックすると、デバイスの詳細画面に移動します。現在カメラに写っている画像は、デバイス詳細画面の<em>CAMERA</em>メニューから確認することができます。</p>
<p class="image-container"><img style="width: 601.70px" src="img/7b7747400122ed8f.png"></p>
<p>Updateボタンをクリックすると現在のカメラの画像が表示されます。</p>
<p class="image-container"><img alt="A screenshot of a cell phone\n\nDescription automatically generated" style="width: 601.93px" src="img/99f2073ac1289eb.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="OCRを試してみる" duration="15">
        <p>S+ Camera Basic向けの<a href="https://dev.soracom.io/jp/mosaic/sample-algorithm/" target="_blank">サンプルアルゴリズムは多数公開</a>されており、GUIから簡単にインストールして試すことができるようになっています。今回のテーマでもあるOCRのサンプルアルゴリズムをインストールしてみましょう。</p>
<p>デバイス詳細画面のAPP(CAMERAAPP0)タブを開き「Install new algorithm」というボタンを押してください。</p>
<p class="image-container"><img style="width: 601.70px" src="img/ad8be5d4e25ce695.png"></p>
<p>公開済みのサンプルアルゴリズムの一覧が表示されますので、リストの中からOCRを選択してInstallを実行してください。</p>
<p class="image-container"><img style="width: 601.70px" src="img/19455ccbbffdcb95.png"></p>
<p>インストールは1〜2分で終わります。下記の画像のようにCameraApp OCR Sampleの名称とバージョンが表示されるようになっていたらOKです。</p>
<p class="image-container"><img style="width: 601.70px" src="img/9a4282dd37466282.png"></p>
<p>さて、ここから実際に試してみましょう。このアルゴリズムはARマーカーに囲われた英数字をデータ化し、その読み取ったテキストデータをSORACOM Havest Dataへ、読み取ったテキストデータを元画像に対して付与した下記のような画像をSORACOM Harvest Filesにアップロードします。なお、データや画像ファイルのアップロードは、データ読み取りに成功したときのみ実行されます。（つまり、カメラの画角内に読み取れる対象が何も配置されていない場合、データはアップロードされません）</p>
<p>ARマーカーについては<a href="https://dev.soracom.io/jp/mosaic/sample-algorithm/#aruco-ocr" target="_blank">こちらに作成方法とサンプルがあります</a>のでご利用ください。まず試すだけであれば、ここにある画像をそのまま印刷すればOKです。</p>
<p class="image-container"><img style="width: 345.39px" src="img/7b8027775351d5fd.png"></p>
<p>上記のような素材に対して数分間カメラを向けて置くと、SORACOM Havest Dataに以下のようなデータがアップロードされ始めるのが確認できます。</p>
<p class="image-container"><img style="width: 601.70px" src="img/8ead916618b2c1ba.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="実際のメーターのデータを読んでみる" duration="20">
        <p>より実践的に、以下のようなオフラインのメーターをデータ化するということにチャレンジしてみたいと思います。</p>
<p class="image-container"><img style="width: 197.63px" src="img/180107739b4404d7.png"></p>
<p>この温湿度計に使われている字体は7セグメント(フォント)と呼ばれ、私達にはおなじみのものですが、ゴシック体や明朝体やサンセリフ体などのより一般的に利用されるフォントとは違い、コンピュータにとっては見慣れないもののようで、<a href="https://github.com/tesseract-ocr/tesseract" target="_blank">tesseract</a>というこのサンプルアルゴリズムで利用しているOCRエンジンでも、デフォルトでは読み取ってくれません。ではどうすればいいのでしょうか？</p>
<p>これを解決する方法として、7セグメントを読み取るために学習されたデータを用意し、それをOCRエンジンに適用して動かしていきます。</p>
<p>とは言っても適用用法は簡単です。デバイス詳細画面のAPP(CAMERAAPP0)タブのPARAMETERにそれぞれ以下の値を指定してください。</p>
<p>SORACOM_ENV_URI</p>
<pre><code>https://raw.githubusercontent.com/Shreeshrii/tessdata_ssd/master/ssd_int.traineddata</code></pre>
<p>SORACOM_ENV_FREE_PARAM</p>
<pre><code>{
  &#34;OEM&#34;: 1,
  &#34;PSM&#34;: 6,
  &#34;TESSDATA_DIR&#34;: &#34;./&#34;
}</code></pre>
<p class="image-container"><img style="width: 601.70px" src="img/d2747f8363fe075b.png"></p>
<p>これらのPARAMETERの値は文字列としてアルゴリズムに渡されます。アルゴリズムは、SORACOM_ENV_URIに指定されたURLから学習済みファイルをダウンロードします。またSORACOM_ENV_FREE_PARAMに指定された文字列をJSONとしてパースし、内部に保存された値を使って挙動を変化させています。より具体的にはTESSDATA_DIRはそのファイルの保存先をOCRエンジンに対して教えるためにつかう、といった具合です。（このあたりはあくまでみなさまご自身のアルゴリズム開発の際に「こんな使い方があるんだな」という参考として見ていただければ大丈夫です）</p>
<p>さて、さっそく読み取ってみましょう。下記の例では左側は27、右側は26といった形で、整数部のみですがきれいに読み取れました。（なお、やはりここでもARマーカーは必要になってきます）</p>
<p class="image-container"><img style="width: 458.00px" src="img/9e3ae0b63b94df43.png"></p>
<p>先程の例では読み取ったデータをSORACOM Harvest Dataで参照していましたが、もちろんSORACOM Lagoonでより高度な可視化を行うこともできます。まずは下記の例のようにテーブル形式で読み取りデータをそのまま表示してやるのがよいでしょう。Textという項目に実際に読み取られた文字データが入ってきます。これを見ながら読み取り結果が満足な形になるようにカメラの画角や明るさなどを調整していきましょう。</p>
<p class="image-container"><img style="width: 601.70px" src="img/b15873f9af57ac85.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="あとかたづけと注意事項" duration="1">
        <p>本レシピでは費用がかかるサービスを利用しています。本項をよく読み、必要な操作や解除作業を行うようにして、想定外の費用が掛からないようにしてください。</p>
<h2 is-upgraded>費用について</h2>
<p>ここで記載している金額は全て税別、送料別となります。</p>
<h3 is-upgraded>SORACOM プラットフォームの利用料金</h3>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>サービス／機能</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>料金</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><a href="https://soracom.jp/services/air/cellular/price_specific_area_sim/" target="_blank">SORACOM Air (plan-D)</a></p>
</td><td colspan="1" rowspan="1"><ul>
<li>基本料: 10円/日</li>
<li>通信料: 0.2円~/MB</li>
</ul>
<p>(今回の利用であれば 100MB 以内で収まる範囲)</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><a href="https://soracom.jp/services/harvest/price/" target="_blank">SORACOM Harvest Data</a></p>
</td><td colspan="1" rowspan="1"><p>1 リクエストあたり 0.004 円</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><a href="https://soracom.jp/services/harvest/price/" target="_blank">SORACOM Harvest Files</a></p>
</td><td colspan="1" rowspan="1"><p>SORACOM Harvest FIles は一般的なファイル管理サービスとは異なり「データ転送量」に応じた課金体系です。保管されているファイル(サイズ)には費用は発生しません。例えば先月に1GBのファイルのアップロードを行った場合、1GBの転送に関して課金されます。翌月の転送が0バイトだった場合、先月の1GB分は保管されていますが、このファイルには費用は発生しません。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><a href="https://soracom.jp/services/napter/price/" target="_blank">SORACOM Napter</a></p>
</td><td colspan="1" rowspan="1"><p>300 円 (SIM 1枚あたり、月額、税別)</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><a href="https://soracom.jp/services/inventory/price/" target="_blank">SORACOM Inventory</a></p>
</td><td colspan="1" rowspan="1"><p>最初の登録: 1 USD/台・回</p>
<p>50 円/台・月</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><a href="https://soracom.jp/services/mosaic/price/" target="_blank">SORACOM Mosaic</a></p>
</td><td colspan="1" rowspan="1"><p>月額費用 1,700円。利用月は無料。</p>
</td></tr>
</table>
<p>※ 費用詳細はリンク先をご確認ください。</p>
<aside class="special"><p><strong>無料利用枠について</strong></p>
<p>SORACOM サービスでは一部サービスにおいて無料枠が設定されています。たとえば SORACOM Air for セルラーであればアカウント毎で30円/月の通信分や、SORACOM Harvest Data であれば31日分の書込みリクエストなどです。料金詳細に「無料利用枠」として掲載されていますので、ご確認ください。</p>
</aside>
<p><em>SORACOM Harvest Data</em>にアップロードしたデータ、<em>SORACOM Harvest Files</em>にアップロードしたファイル、<em>SORACOM Inventory</em>のデバイス、<em>SORACOM Mosaic</em>など必要ない場合には削除/解約処理をお願いします。</p>


      </google-codelab-step>
    
      <google-codelab-step label="次のステップ" duration="1">
        <p>本レシピでは、OCRによって、通信機能を持たない機器の数値や文字を電子化してSORACOM Harvest Dataに送信しました。OCRの結果とカメラの映像を同時に出したいときや、ある数値が検出された際にアラートを出したいような場合には<a href="https://soracom.jp/services/lagoon/" target="_blank"><em>SORACOM Lagoon</em></a>をご利用いただけます。</p>
<p><a href="https://soracom.jp/products/industrial_devices/soracom-plus-camera-basic/" target="_blank">商品ページへ戻る</a></p>
<p>よくあるご質問は<a href="https://dev.soracom.io/jp/mosaic/faqs/" target="_blank">こちら</a>でご案内しています。</p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://soracom.github.io/iot-recipes/codelab-elements/native-shim.js"></script>
  <script src="https://soracom.github.io/iot-recipes/codelab-elements/custom-elements.min.js"></script>
  <script src="https://soracom.github.io/iot-recipes/codelab-elements/prettify.js"></script>
  <script src="https://soracom.github.io/iot-recipes/codelab-elements/codelab-elements.js"></script>

</body>
</html>
