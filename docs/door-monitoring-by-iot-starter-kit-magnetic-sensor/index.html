
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>【IoT DIY レシピ】IoT 体験キット ～磁気センサー～ で作る「ドアの開閉モニタリング」</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://soracom.github.io/iot-recipes/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-66865146-33"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="door-monitoring-by-iot-starter-kit-magnetic-sensor"
                  title="【IoT DIY レシピ】IoT 体験キット ～磁気センサー～ で作る「ドアの開閉モニタリング」"
                  environment="web"
                  feedback-link="https://soracom.jp/products/kit/magnetic_sensor_kit/">
    
      <google-codelab-step label="SORACOM LTE-M Button Plusでできる「ドアの開閉モニタリング」" duration="1">
        <p>レシピ難易度：★★☆☆☆</p>
<p>SORACOM LTE-M Button Plus と磁石で動くスイッチセンサー(磁気式リードスイッチ)がセットになった「IoT 体験キット ～磁気センサー～」を利用したドアのモニタリングです。SORACOM のサービスを活用してドア開閉の記録から通知までを行います。</p>
<p class="image-container"><img style="width: 602.00px" src="img/b05c2591e4d70e90.png"></p>
<p class="image-container"><img style="width: 480.00px" src="img/20b515524b4e36d0.gif"></p>
<h2 is-upgraded>本レシピを行うのに必要な時間、概算費用</h2>
<p>本レシピは以下の通りです。</p>
<ul>
<li>必要な時間: 約90分</li>
<li>概算費用: 約9500円</li>
</ul>
<p>※ 概算費用: ハードウェアや SORACOM を始めとした各種サービスの概ねの費用 (税や送料などの付帯費用や無料枠適用は考慮しないものとしています)</p>
<h2 is-upgraded>このコンテンツの進め方</h2>
<p>ページの内容を読み、また作業を行ったら右下の［Next］を押して次のステップへ進みます。また、［Back］を使って戻ったり、左のナビゲーションメニューでもページの移動が可能です。</p>
<p>左上の［×］を押してコンテンツを終了することができます。また、ページを開きなおすことで再開できます。ページのアドレスはブラウザの［履歴］メニューを利用してください。</p>

<aside class="warning"><p>本コンテンツは現状のままで提供され、株式会社ソラコムは、誤りがないことの保証を含め、明示であると黙示であるとを問わず、本コンテンツの記載内容につき、いかなる種類の表明も保証も行いません。</p>
<p>掲載情報の閲覧及び利用により、利用者自身、もしくは第三者が被った損害に対して、直接的、間接的を問わず、株式会社ソラコムは責任を負いかねます。</p>
<p>本コンテンツを実践する中で用意された機器、利用されたサービスについてのご質問は、それぞれの機器やサービスの提供元にお問い合わせをお願いします。機器やサービスの仕様は、本コンテンツ作成当時のものです。</p>
<p>株式会社ソラコムが提供する機器・サービスについてのご質問は、 <a href="https://soracom.jp/contact/" target="_blank">https://soracom.jp/contact/</a> をご確認の上、適切な窓口へのお問い合わせをお願いします。機器・サービスご利用前の導入相談は <a href="https://soracom.jp/contact/contactsales/" target="_blank">https://soracom.jp/contact/contactsales/</a> に、機器・サービスご利用開始後のサポートは、SORACOMユーザーコンソール内の<a href="https://soracom.zendesk.com/hc/ja/requests/" target="_blank">サポートサイトから「リクエストを送信」</a>(要ログイン)にてお問い合わせください。</p>
<p>本ドキュメントは <a href="https://github.com/googlecodelabs/tools" target="_blank">CLaaT</a> を用いて制作しています</p>
<p>Copyright (c) 2020 SORACOM, INC.</p>
</aside>



      </google-codelab-step>
    
      <google-codelab-step label="準備" duration="1">
        <p>本レシピを行うためには以下のものをご用意ください。</p>
<h2 is-upgraded>ハードウェア</h2>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>品名</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>数量</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>価格</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>購入先</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>備考</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><a href="https://soracom.jp/products/kit/magnetic_sensor_kit/" target="_blank">IoT 体験キット ～ 磁気センサー</a></p>
</td><td colspan="1" rowspan="1"><p>1</p>
</td><td colspan="1" rowspan="1"><p>8,880円</p>
</td><td colspan="1" rowspan="1"><p>ソラコム</p>
</td><td colspan="1" rowspan="1"><p>キットの中には以下のものが含まれています。<br>(それぞれを個別に準備しても構いません)</p>
<ul>
<li>SORACOM LTE-M Button Plus 本体 x 1</li>
<li>磁気センサースイッチ x 1</li>
<li>接続端子 x 1</li>
</ul>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>パソコン</p>
</td><td colspan="1" rowspan="1"><p>1</p>
</td><td colspan="1" rowspan="1"><p>―</p>
</td><td colspan="1" rowspan="1"><p>―</p>
</td><td colspan="1" rowspan="1"><ul>
<li>インターネット接続が可能でサイトへの接続が自由であること。</li>
<li>Google Chrome 等の最新ブラウザーが利用可能な事。        </li>
</ul>
</td></tr>
</table>
<p>※ 金額はレシピ作成時となります。税抜き・送料別です。</p>
<h2 is-upgraded>その他必要なもの</h2>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>必要なもの</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>費用</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>作成方法など</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>SORACOM アカウント</p>
</td><td colspan="1" rowspan="1"><p>無料※</p>
</td><td colspan="1" rowspan="1"><p><a href="https://soracom.github.io/iot-recipes/create-account-soracom-jp/" target="_blank">SORACOM アカウントの作成 (JP)</a></p>
</td></tr>
</table>
<p>※ アカウント作成・維持の費用の料金です。</p>
<h2 is-upgraded>設置に利用したもの</h2>
<p>本レシピで設置時に利用した部材です。必須ではありませんがご参考にお使いください。</p>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>品名</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>数量</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>備考</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>ビニールタイ</p>
</td><td colspan="1" rowspan="1"><p>1</p>
</td><td colspan="1" rowspan="1"><p>ケーブルをまとめるのに役立ちます。<a href="https://www.amazon.co.jp/dp/B000QUD1EQ" target="_blank">約400円</a>です。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>両面テープ</p>
</td><td colspan="1" rowspan="1"><p>1</p>
</td><td colspan="1" rowspan="1"><p>磁気センサー等の固定用です。</p>
<p>設置面を傷めて怒られないように配慮できる粘着力のものをご用意ください。</p>
</td></tr>
</table>


      </google-codelab-step>
    
      <google-codelab-step label="SORACOM LTE-M Button が届いたら" duration="5">
        <p>SORACOM LTE-M Button は、 SORACOM に登録することで様々なクラウドとの連携が可能となります。そのため、まず SORACOM LTE-M Button がお手元に届いたら、SORACOM へ登録をしましょう。<br>※ すでに登録済みの場合は次へお進みください。</p>
<p>登録の方法は<a href="https://soracom.github.io/iot-recipes/register-ordering-sim-jp/" target="_blank">発注済みの SIM を登録する(JP)</a>をご覧ください。約5分で完了します。</p>
<p>登録が完了すると SORACOM LTE-M Button が &#34;準備完了&#34; として、SIM 管理の一覧に表示されますので、確認ください。</p>
<aside class="special"><p><strong>SORACOM の便利な使い方: SIM の「名前」機能</strong></p>
<p>SIM には「名前」を付けることができ、これで整理が可能です。特に複数の SIM (ボタン含む) をお持ちの際には、名前を付けることを強くお勧めいたします。</p>
<p>名前の付け方は <a href="https://dev.soracom.io/jp/start/console/#name_tag" target="_blank">SIM への名前の付け方</a>をご覧ください。</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="グループの作成と SIM の所属させる" duration="10">
        <p>SORACOM の IoT データ収集・蓄積サービス <a href="https://soracom.jp/services/harvest/" target="_blank"><strong>SORACOM Harvest Data</strong></a> を利用して、データの可視化を簡単に実現してみましょう。</p>
<p>まずは<strong>グループ</strong>の作成と、作成したグループへ SIM を所属させる事から始めます。</p>
<aside class="special"><p><strong>SORACOM Harvest Data とは？</strong></p>
<p>IoT デバイスからのデータの収集や蓄積、およびファイルを保存するサービスが SORACOM Harvest (ソラコム ハーベスト) です。IoT デバイスからのデータの収集・蓄積対応しているのが SORACOM Harvest Data、画像ファイルやログファイルといったファイルに対応しているのが SORACOM Harvest Files となります。</p>
</aside>
<aside class="special"><p><strong>グループとは？</strong></p>
<p>SORACOM サービスのほとんどが<strong>グループ</strong>という単位に対して設定するようになっています。SORACOM Harvest Data 等、SORACOM サービスのほとんどが SIM に直接設定をするのではなくグループに設定をします。そして、SIM をグループに所属させることで SORACOM サービスが利用できるという間接的な仕組みです。<img style="width: 764.50px" src="img/59a3bc5bf39d1434.png"></p>
<p>グループを作成してから SIM を所属させる方法の他、グループの作成と SIM の所属を同時に行う方法もあります。本レシピでは後者の「同時に行う」手順で進めていきます。</p>
</aside>
<h2 is-upgraded><a href="https://console.soracom.io/" target="_blank">SORACOM ユーザーコンソール</a>にログインした後［Menu］&gt;［SIM 管理］とクリックして SIM 管理画面を開きます。</h2>
<p class="image-container"><img style="width: 566.00px" src="img/9da8277c082724ca.png"></p>
<aside class="warning"><p><strong>［SIM 管理］をクリックしても画面が切り替わらない場合は？</strong></p>
<p>すでに SIM 管理画面を開いている場合は、［SIM 管理］をクリックしても画面が切り替わることがありません。その場合、青の点線で囲まれている「SORACOM ロゴ」をクリックすることでメニューを閉じることができます。</p>
</aside>
<h2 is-upgraded>SORACOM Harvest Data でデータの収集を行いたい SIM (SORACOM LTE-M Button) にチェックを付け、［操作］&gt;［所属グループ変更］とクリックします。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/1b3453a80a2c4bfd.png"></p>
<aside class="special"><p><strong>SORACOM の便利な使い方: 複数の SIM を同時に扱う</strong></p>
<p>チェックをつける対象を複数にすれば、一度の複数の SIM を対象に操作が可能です。</p>
</aside>
<h2 is-upgraded>「新しい所属グループ」のプルダウンボックスをクリックした後、［新しいグループを作成...］をクリックします。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/9cf95365d7028f2c.png"></p>
<h2 is-upgraded>「グループ作成」のグループ名を入力して［グループ作成］をクリックします。</h2>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>例</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>備考</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>グループ名</p>
</td><td colspan="1" rowspan="1"><p><code>door-monitor</code></p>
</td><td colspan="1" rowspan="1"><p>自由に入力可能です。日本語も設定可能です。</p>
</td></tr>
</table>
<p class="image-container"><img style="width: 385.00px" src="img/4b3c529304b53db4.png"></p>
<h2 is-upgraded>新しい所属グループが先ほど作成したグループになっていることを確認したら［グループ変更］をクリックします。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/6fdcb44201c45385.png"></p>
<h2 is-upgraded>自動的に SIM 管理画面に戻ります。<br>SIM の「グループ」に先ほど作ったグループが設定されていることを確認してください。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/f539023656397027.png"></p>
<p>以上で、グループの作成と所属の作業は完了です。</p>


      </google-codelab-step>
    
      <google-codelab-step label="グループの設定を行う" duration="15">
        <p>グループに「<strong>バイナリ―パーサー機能</strong>」「<strong>SORACOM Harvest Data</strong>」の2つの設定を行います。</p>
<aside class="special"><p><strong>バイナリ―パーサー機能とは？</strong></p>
<p>ハードウェア開発では容量を節約するために「バイナリ形式」のデータを用いることがあります。一方、昨今のクラウドはシステム開発を容易にするために「JSON 形式」のデータを扱うことが多くあります。バイナリ―パーサー機能は、SORACOM プラットフォーム上でバイナリからJSONへ変換する仕組みです。この機能を利用することで、データ変換用のシステムやプログラムが不要となります。詳細は<a href="https://dev.soracom.io/jp/docs/binary_parser/" target="_blank">リファレンス</a>をご覧ください。</p>
</aside>
<aside class="special"><p><strong>覚えておきたい知識：簡易位置測位機能</strong></p>
<p>SORACOM LTE-M Button の通信で使用している &#34;plan-KM1&#34; というサブスクリプション(通信プラン) は、携帯電話の基地局の位置情報や電波の強さを基に、LTE 通信の通信開始時点でのおおよその位置情報を取得して SORACOM サービスと連携できる機能が利用できます。</p>
<p>今回のレシピでは利用しませんが、LTE 通信のみで利用できることから GPS 等が無くとも位置測位が可能となります。興味がある方は<a href="https://dev.soracom.io/jp/docs/location_service/" target="_blank">簡易位置測位機能の設定ガイド</a>をご覧ください。</p>
<p>※ SORACOM LTE-M Button powered by AWS は plan-KM1 を使用していますが本機能が利用できません。</p>
</aside>
<h2 is-upgraded>SIM 管理画面から、SORACOM LTE-M Button に割り当てたグループ名をクリックします。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/1289cef15a24ed32.png"></p>
<h2 is-upgraded>［SORACOM Air for Cellular 設定］をクリックして設定ができるように開きます。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/28c1e31f576c8af5.png"></p>
<h2 is-upgraded>「SORACOM Air for Cellular 設定」で以下のように設定します。</h2>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>設定値</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>備考</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>バイナリ―パーサー設定</p>
</td><td colspan="1" rowspan="1"><p>ON</p>
</td><td colspan="1" rowspan="1"><p>スイッチはクリックすることで OFF から ON に切り替えることができます。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>バイナリ―パーサー設定 / フォーマット</p>
</td><td colspan="1" rowspan="1"><p><code>@button</code></p>
</td><td colspan="1" rowspan="1"><p>半角英数で入力してください。</p>
</td></tr>
</table>
<p class="image-container"><img style="width: 509.00px" src="img/99a6bf4a706e57e2.png"></p>
<p>最後に［保存］をクリックしてください。</p>
<h2 is-upgraded>同じページの中にある［SORACOM Harvest Data 設定］をクリックして設定ができるように開きます。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/7628690cf5f7b17e.png"></p>
<h2 is-upgraded>「SORACOM Harvest Data 設定」で以下のように設定します。</h2>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>設定値</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>備考</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>（スイッチ）</p>
</td><td colspan="1" rowspan="1"><p>ON</p>
</td><td colspan="1" rowspan="1"><p>スイッチはクリックすることで OFF から ON に切り替えることができます。</p>
</td></tr>
</table>
<p class="image-container"><img style="width: 262.00px" src="img/b8dd4f4f9fc5f281.png"></p>
<p>最後に［保存］をクリックしてください。<br>その後表示される「SORACOM Harvest Data が有効になっています」のダイアログでは［OK］をクリックしてください。</p>
<p>以上で「バイナリ―パーサー機能」SORACOM Harvest Data」の2つの設定が完了しました。<br>すでに SORACOM LTE-M Button (の SIM)は、このグループに所属しているためこの時点から SORACOM LTE-M Button からのデータが SORACOM Harvest Data に表示されるようになります。</p>


      </google-codelab-step>
    
      <google-codelab-step label="SORACOM Harvest Data でデータを確認する" duration="10">
        <p>SORACOM LTE-M Button からのデータが SORACOM Harvest Data に表示されることを確認してみましょう。</p>
<h2 is-upgraded>［Menu］&gt;［SIM 管理］とクリックして SIM 管理画面を開きます。</h2>
<p class="image-container"><img style="width: 566.00px" src="img/9da8277c082724ca.png"></p>
<h2 is-upgraded>SORACOM Harvest Data でデータの表示を行いたい SIM (SORACOM LTE-M Button) にチェックを付け、［操作］&gt;［データを確認］とクリックします。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/d70a40f803c2218d.png"></p>
<h2 is-upgraded>表示された画面で［自動更新］を ON にします。</h2>
<p>この表示された画面が SORACOM Harvest Data の画面となります。</p>
<aside class="special"><p><strong>自動更新とは？</strong></p>
<p>画面を再読み込みしなくとも新しいデータが自動的に表示されるようにする機能です。5秒毎に新しいデータを表示するようになります。この機能が OFF の場合は、表示する期間を指定して［検索］をクリックすることで期間内のデータを表示できます。</p>
</aside>
<p class="image-container"><img style="width: 770.29px" src="img/65102e07fb744e69.png"></p>
<h2 is-upgraded>SORACOM LTE-M Button を押してデータを確認する</h2>
<p>SORACOM LTE-M Button のデータが SORACOM Harvest Data に表示されていることが確認できます。</p>
<h3 is-upgraded>1件のデータが到着した様子</h3>
<p>※ ボタンを「長押し」したため、<code>clickType</code> の値が <code>3</code> として表示されています。</p>
<p class="image-container"><img style="width: 745.50px" src="img/4641aa400adeb567.png"></p>
<h3 is-upgraded>データテーブルを表示する</h3>
<p>データはグラフだけでは無く、ページの下の方でデータテーブルとして表示されます。ここで具体的な値を確認できます。</p>
<p class="image-container"><img style="width: 721.26px" src="img/19e1be1a682b16bc.png"></p>
<p>以上で全ての作業は終了です。</p>


      </google-codelab-step>
    
      <google-codelab-step label="SORACOM LTE-M Button Plus と磁気センサーを接続する" duration="15">
        <h2 is-upgraded>「接続端子」の使い方</h2>
<p>キットに付属の接続端子は、ハンダ付けや圧着チューブ等を利用せずともケーブル同士を簡易的に接続できる端子です。矢印の方向に結線（接続）されており、このモデルは同時に2本のケーブルをつなげることができます。</p>
<p class="image-container"><img style="width: 277.00px" src="img/ee991973770b9b31.png"></p>
<h3 is-upgraded>SORACOM LTE-M Button Plus との接続ケーブルを接続する</h3>
<p>まず、SORACOM LTE-M Button Plus との接続ケーブル(片方に白い端子がついているケーブル)を接続します。(皮膜は取って、金属部分が見えるようにしてください)</p>
<p>端子上部を押さえると、穴の中の金属部分が押し下げられてケーブルが押し込めるようになります。上部を押しつつ、穴にケーブルの金属部分を押し込みます。その後、上部を離すと、金属の弾力でケーブルが固定されます。</p>
<p class="image-container"><img style="width: 480.00px" src="img/74f10b67cbb98e58.gif"></p>
<aside class="special"><p><strong>ケーブルの色について</strong></p>
<p>SORACOM LTE-M Button Plus との接続をするコネクタ付きケーブルの色は、購入時期によって「赤・黒」と「黒・黒」がありますが、ケーブル色と接続先は無関係ですので、どちらの口にケーブルを差しても問題ありません。</p>
</aside>
<p>押し込める長さはおよそ 5~8mm です。取り付けた後、軽く引っ張ってみて取れなければ成功です。（強く引きすぎると抜けてしまうので注意ください。）</p>
<p>ケーブルの取り外しは、取り付けた時と同様に上部を押さえます。ゆるんだタイミングでケーブルを引き抜いてください。</p>
<aside class="warning"><p><strong>接続端子はあくまで試験時の利用に留めてください</strong></p>
<p>本格的な運用においては接続端子を用いず、ハンダ付けや圧着チューブなどで接続して安定的な結線をするのが望ましいです。</p>
</aside>
<h2 is-upgraded>「IoT 体験キット ～ 磁気センサー」に含まれている磁気センサーにについて</h2>
<p>キットに含まれている磁気センサーは「センサー部」「磁石部」という2つの部位で構成されています。</p>
<p class="image-container"><img style="width: 439.50px" src="img/8f9aa08ac7b927af.png"></p>
<p>センサー部からは3本のケーブルが出ていますが、このケーブルの組み合わせ方でセンシング可能な内容を「離れた時に &#34;ON&#34;」もしくは「近づいた時に &#34;ON&#34;」と変更できます。</p>
<h3 is-upgraded>離れた時に &#34;ON&#34; となる組み合わせ</h3>
<p>磁気センサー部の「灰」と「赤」のケーブルを SORACOM LTE-M Button と接続します。これにより、磁気センサーのセンサー部と磁石部が離れた時にセンサーが &#34;ON&#34; となります。</p>
<p class="image-container"><img style="width: 435.00px" src="img/925343fbbbd39056.png"></p>
<p>例えば、玄関のような「普段は閉まっているドア」に取り付けておき、「開いたら ON」に利用できます。</p>
<h3 is-upgraded>近づいた時に &#34;ON&#34; となる組み合わせ</h3>
<p>磁気センサー部の「灰」と「白」のケーブルを SORACOM LTE-M Button と接続します。これにより、磁気センサーのセンサー部と磁石部が近づいた時にセンサーが &#34;ON&#34; となります。</p>
<p class="image-container"><img style="width: 435.00px" src="img/f2acffe7f20ae739.png"></p>
<p>例えば、店舗の入り口のような「普段は開いているドア」に取り付けておき、「閉まったら ON」に利用できます。</p>
<h3 is-upgraded>センサーの反応距離</h3>
<p>センサーの反応距離は約 2cm です。これよりこれより離れると ON 、もしくは、近づくと  ON となります。（センサーの個体差があるため、設置前に確認するようにしてください。）</p>
<p class="image-container"><img style="width: 437.00px" src="img/7380db0fff2849d5.png"></p>
<p>接続した後は何度かテストを行ってください。</p>
<aside class="warning"><p><strong>誤動作する時がある？</strong></p>
<p>磁気センサーは、センサー部の中に磁力で ON/OFF するスイッチが入っており、それに対して磁石部の中にある永久磁石が近づく・離れることでセンサー部が ON/OFF するようになっています。センサー部は対となっている磁石部でなくとも「磁石であれば何でも反応する」ため、磁力を有しているものが近づく事でセンシングしてしまう事もあり得ます。昨今ではタブレットのフタやノートパソコンの閉じる部分に磁石が使われていますので、何らかの理由でそこに反応してしまう可能性があります。そのため、取り付け位置は誤判定を避けるような位置を検討してください。</p>
</aside>
<aside class="special"><p><strong>センシング範囲を変更したい場合は？</strong></p>
<p>磁石部には永久磁石が入っています。センサー部は対になっている磁石部である必要が無いため、この磁石部を変更することで、センシング範囲を変更可能です。例えば、ネオジム磁石のような強力なものを利用することで範囲を広げることができます。一方、センサー部が着磁(磁石化)して常に ON (もしくは常に OFF)の状態となり不良となってしまう恐れもあるので注意が必要です。</p>
</aside>
<aside class="special"><p><strong>センサーから発せられるデータ (clickType) について</strong></p>
<p>センサーからのデータは <code>clickType = 3</code> 即ち「長押し」として送信されることがほとんどです。これは、センサーに近づいて（もしくは離れて）センサーが反応した状態が「ボタンを押した状態」と同じであるためです。そのため、センサー部と磁石部を短時間で近づけたり離したりすれば、<code>clickType = 1</code> (シングル押し) や <code>clickType = 2</code> (ダブル押し) としてデータ送信されます。</p>
<p>取り付ける対象にもよりますが、磁気センサーを用いた場合はあまり細かい動作制御が難しいことがほとんどですので、<code>clickType</code> の値は利用せずに「データが発生した」という事実のみを利用した方が好ましい結果が得られるでしょう。</p>
</aside>
<aside class="special"><p><strong>近づいた時と離れた時の両方をセンシングするには？</strong></p>
<p>SORACOM LTE-M Button Plus を2台使用することで、近づいた時と離れた時の両方のセンシングが可能です。（接続端子は省略しています。）</p>
<p class="image-container"><img style="width: 435.00px" src="img/842e65234d10c96e.png"></p>
<p>ポイントは灰色ケーブルを共有するところです。</p>
<p>また、発せられたデータがどちらのボタンから来たのか識別する方法は、ボタンに割り当てられている IMSI(加入者識別番号) が利用できます。</p>
<p>※ SORACOM LTE-M Button Plus 1台で実現したい場合は、本キットに同梱の磁気センサーでは無く、対応するセンサーに変更することで可能となります。</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="ドアに取り付ける" duration="20">
        <p>今回は横開きのドアに取り付けました。普段は閉まっていて、開いた時（＝離れた時に ON）にする組み合わせとしました。</p>
<p>SORACOM LTE-M Button Plus の側面に両面テープを貼り、柱に貼り付けてあります。壁紙が若干弱く、両面テープの剥離時に壁面を傷めてしまう恐れがあったため、このような取り付けにしています。</p>
<p>ドアが閉まった状態で近づくようにセンサー部を柱に、磁石部をドア側に貼り付けています。これらも両面テープです。</p>
<p class="image-container"><img style="width: 602.00px" src="img/ed41298d3fb873a4.png"></p>
<p>邪魔なケーブルはいったんビニールタイでまとめています。設置位置が決まったら必要な長さにカットする等しましょう。</p>
<aside class="special"><p><strong>稼働する方に磁石部を取り付けましょう</strong></p>
<p>センサー部を稼働する方に取り付けてしまうと SORACOM LTE-M Button Plus 本体も稼働する方に取り付ける必要が出てきてしまいます。稼働する方には取り付けが簡単な磁石部を付けるようにしましょう。</p>
</aside>
<h2 is-upgraded>動作の様子</h2>
<p>開いた直後に SORACOM LTE-M Button Plus の LED の点滅が開始（＝通信開始）していることがわかるかと思います。</p>
<p class="image-container"><img style="width: 480.00px" src="img/20b515524b4e36d0.gif"></p>
<p>実際に動作させてみて SORACOM Harvest Data でデータの受信状況を確認してみてください。</p>
<aside class="special"><p><strong>連続したドアの開閉の扱いは？</strong></p>
<p>SORACOM LTE-M Button Plus は乾電池で動作するように省電力化されています。それを実現するため、普段は通信部分を OFF にしており、センサーが反応したタイミングで始めて通信を開始します。（スマートフォンで例えるなら、普段は電源 OFF にしてあり、必要なときのみ ON にして立ち上がってから通信を開始するようなものです。）</p>
<p>通信開始からデータ送信終了までに約8~12秒程度かかりますが、その間に発生したデータは全て無視されるため、あまり頻度の高い開閉のセンシングには向いていません。このような頻度の高い通信を処理したい場合は <a href="https://soracom.jp/products/module/wio_lte/" target="_blank">Wio LTE JP Version</a> のようなマイコンの活用を検討します。</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="SORACOM Funk でメールによる通知をする" duration="10">
        <p>SORACOM LTE-M Button を押した時に、メールの通知を行えるように設定してみましょう。そのためには、クラウドファンクションアダプタ <a href="https://soracom.jp/services/funk/" target="_blank"><strong>SORACOM Funk</strong></a> を利用します。</p>
<aside class="special"><p><strong>SORACOM Funk とは？</strong></p>
<p>SORACOM Funk は、クラウドサービスの Function を直接実行できるサービスです。</p>
<p>一般的にIoTデバイスは電力消費などを抑える目的からシンプルな構成であることが多く、そのような場合はデバイス側での複雑なデータ処理が難しい場合があります。また、デバイス側がこのような複雑なデータ処理が可能な場合も、多くの電力を消費します。</p>
<p>そのような場合、FaaS(Function as a Service)と連携することで、IoTデバイスのリソースを使用することなく、クラウドの膨大なリソースで複雑な処理を実行することができます。クラウドが提供する FaaS として、以下の3つに対応しています。</p>
<ul>
<li>AWS Lambda</li>
<li>Azure Functions</li>
<li>GCP Cloud Functions</li>
</ul>
</aside>
<p>本ハンズオンでは、あらかじめソラコムが用意した AWS アカウントの Lambda Function (Hosted Funk) を利用することで、簡単にメールが送信が可能です。</p>
<aside class="warning"><p><strong>Hosted Funk について</strong></p>
<p>Hosted Funk はソラコムが提供するハンズオンやレシピ向けとしての試験途上の機能(2020年6月現在)です。そのため、今後やむなく、また事前の連絡無く機能の変更や廃止の可能性があることをご承知おきください。</p>
</aside>
<h2 is-upgraded>SIM 管理画面から、SORACOM LTE-M Button に割り当てたグループ名をクリックします。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/1289cef15a24ed32.png"></p>
<h2 is-upgraded>［SORACOM Air for Cellular 設定］をクリックして設定ができるように開きます。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/28c1e31f576c8af5.png"></p>
<h3 is-upgraded>「メタデータサービス設定」で以下のように設定します。</h3>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>設定値</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>備考</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>(スイッチ)</p>
</td><td colspan="1" rowspan="1"><p>ON</p>
</td><td colspan="1" rowspan="1"><p>スイッチはクリックすることで OFF から ON に切り替えることができます。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>ユーザーデータ</p>
</td><td colspan="1" rowspan="1"><p>下記の &#34;メール 文章&#34; を入力</p>
</td><td colspan="1" rowspan="1"><p>―</p>
</td></tr>
</table>
<p>メール文章</p>
<pre>ドアが開きました！
時刻: &#123;&#123;etc.timestamp}} にドアが開いたことを検知しました。</pre>
<p class="image-container"><img style="width: 602.00px" src="img/50ffff752c6c840b.png"></p>
<p>ここで［保存］をクリックしてください。</p>
<h2 is-upgraded>そのあと、同じページの[SORACOM Funk 設定] をクリックして設定ができるように開きます。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/cdb9a16aaa0c8c15.png"></p>
<h2 is-upgraded>「SORACOM Funk 設定」で以下のように設定します。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/a62d1908ba8e4fe7.png"></p>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>設定値</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>備考</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>(スイッチ)</p>
</td><td colspan="1" rowspan="1"><p>ON</p>
</td><td colspan="1" rowspan="1"><p>スイッチはクリックすることで OFF から ON に切り替えることができます。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>サービス</p>
</td><td colspan="1" rowspan="1"><p>AWS Lambda</p>
</td><td colspan="1" rowspan="1"><p>デフォルトで選択されています。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>送信データ形式</p>
</td><td colspan="1" rowspan="1"><p>JSON</p>
</td><td colspan="1" rowspan="1"><p>デフォルトで選択されています。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>認証情報</p>
</td><td colspan="1" rowspan="1"><p>認証情報を指定しない</p>
</td><td colspan="1" rowspan="1"><p>―</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>関数の ARN</p>
</td><td colspan="1" rowspan="1"><p>下記の &#34;関数の ARN&#34; を指定</p>
</td><td colspan="1" rowspan="1"><p>―</p>
</td></tr>
</table>
<p>関数の ARN</p>
<pre>arn:aws:lambda:ap-northeast-1:762707677580:function:funk-button-email:prod</pre>
<p>最後に [保存] を押します。これで準備は完了です。</p>
<h2 is-upgraded>SORACOM LTE-M Button を押してメールを送信する</h2>
<p>この状態で SORACOM LTE-M Button を押すと、オペレーターのメールアドレスに以下のようなメールが送信されます。</p>
<p class="image-container"><img style="width: 396.00px" src="img/89529c1866c88d3e.png"></p>
<aside class="special"><p>メールの送信先変更や本文のカスタマイズ方法は、「次のステップ」ページの「Appendix」をご覧ください。</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="あとかたづけと注意事項" duration="1">
        <p>本レシピでは費用がかかるサービスを利用しています。<br>本項をよく読み、必要な操作や解除作業を行うようにして、想定外の費用が掛からないようにしてください。</p>
<h2 is-upgraded>費用について</h2>
<p>ここで記載している金額は全て税別、送料別となります。</p>
<h3 is-upgraded>SORACOM LTE-M Button</h3>
<p>ご利用にあたっては本体の価格とは別に、内蔵されている SIM (plan-KM1) の基本料金(月額100円)と、データ通信量に応じたデータ通信料※が発生します。<br>plan-KM1 の料金は<a href="https://soracom.jp/services/air/cellular/price_specific_area_sim/#plan-km1" target="_blank">ご利用料金 - 特定地域向け IoT SIM (plan-KM1)</a> をご確認ください。</p>
<p>※ 目安として、1送信あたり約 0.25 ~ 0.3 円程度</p>
<p>SORACOM Harvest Data を始めとした SORACOM プラットフォーム利用料は後述の通りかかります。</p>
<h3 is-upgraded>SORACOM プラットフォームの利用料金</h3>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>サービス／機能</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>料金</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><a href="https://soracom.jp/services/harvest/price/" target="_blank">SORACOM Harvest Data</a></p>
</td><td colspan="1" rowspan="1"><p>本機能を有効にしたグループに所属する1SIMあたり5円/日 (2000リクエスト/日/SIMを含む)</p>
<p>2000リクエスト/日を超えた分は0.004円/リクエスト</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><a href="https://soracom.jp/services/funk/price/" target="_blank">SORACOM Funk</a></p>
</td><td colspan="1" rowspan="1"><p>1 リクエスト あたり 0.0018 円</p>
</td></tr>
</table>
<p>※ 費用詳細はリンク先をご確認ください。</p>
<aside class="special"><p><strong>無料利用枠について</strong></p>
<p>SORACOM サービスでは一部サービスにおいて無料枠が設定されています。たとえば SORACOM Air for セルラーであればアカウント毎で30円/月の通信分や、SORACOM Harvest Data であれば31日分の書込みリクエスト、SORACOM Funk であれば 50000 回のリクエストなどです。料金詳細に「無料利用枠」として掲載されていますので、ご確認ください。</p>
</aside>
<h2 is-upgraded>グループ解除</h2>
<p>SORACOM Harvest Data 等、「機能が有効になっているグループに所属している SIM × 費用」となっているサービスにおいては、「機能を OFF にする」することで費用の発生を抑えることができます。またもう1つの方法として「グループに所属している SIM の数を減らす(= 解除する)」事でも費用を抑える事ができます。</p>
<p>また SORACOM Funk の設定やメタデータサービスについては、リクエストが行われなければ費用はかかりませんが、意図せずリクエストが行われるのを避けるため、グループを解除しておくと安心でしょう。</p>
<p>グループ解除の方法は<a href="https://soracom.github.io/iot-recipes/unjoin-from-group/" target="_blank">グループからの解除 (JP)</a>をご覧ください。</p>
<h2 is-upgraded>SORACOM Harvest Data のデータ削除（任意）</h2>
<p>SORACOM Harvest Data は基本的にはデータ保管料は無料※です。そのため、保存しておいても害はありませんが、デモ等で利用する際にはデータを綺麗にしておく必要が出てくるため、データ削除について解説します。</p>
<p>※発生から40日を超えたデータは削除されます。40日以上データを保管したい場合は<a href="https://soracom.jp/services/harvest/price/" target="_blank">データ保持期間延長オプション利用料金</a>をご利用ください。</p>
<p>SORACOM Harvest Data 画面 (［操作］&gt;［データを確認］) のデータテーブルで、削除したいデータのチェックボックスを付けた後に［削除］をクリックします。表示されたダイアログで改めて［削除］をクリックすると、削除されます。<br>※ 複数のデータにチェックをつければ一括で削除可能です。</p>
<p class="image-container"><img style="width: 414.00px" src="img/637cac3bf206c47c.png"></p>
<p><strong>データの復元はできません</strong>のでご注意ください。</p>


      </google-codelab-step>
    
      <google-codelab-step label="次のステップ" duration="1">
        <p>本レシピでは、SORACOM LTE-M Button Plus と磁気センサーを利用したドアの開閉をセンシングしました。</p>
<p>磁気センサーはドアの開閉のみならず、幅広い活用方法が考えられます。</p>
<ul>
<li>トイレやお風呂等の生活で利用するドアに取り付けて、遠く離れた家族の見守り</li>
<li>ガレージや窓に取り付けて、家庭やオフィスの入退出記録</li>
<li>冷蔵庫やワインセラーに取り付けて、扉の閉め忘れ防止</li>
<li>キャビネットに取り付けて、重要書類へのアクセス記録</li>
<li>リモコン等「いつも元に戻しておいてもらいたいもの」に取り付けて、物品の取出し記録・戻し忘れ対策</li>
</ul>
<p>また、SORACOM LTE-M Button Plus の接点 I/F には、磁気センサー以外にも以下のようなセンサーを取り付けることが可能です。</p>
<ul>
<li>傾斜スイッチ</li>
<li>マイクロスイッチ</li>
<li>キーロックスイッチ</li>
</ul>
<p>接続の方法などは <a href="https://sorazine.soracom.jp/entry/2020/03/05/sensors-with-soracom-lte-m-button-plus" target="_blank">半田ごて不要！SORACOM LTE-M Button Plus とセンサーを繋げてみよう</a> をご覧ください。</p>
<p><a href="https://soracom.jp/products/kit/magnetic_sensor_kit/" target="_blank">商品ページへ戻る</a></p>
<h2 is-upgraded>活用事例集</h2>
<p>様々な活用事例がまとまっています</p>
<p><a href="https://sorazine.soracom.jp/entry/2019/04/17/button_usecases" target="_blank">最新LPWA通信規格 &#34;LTE-M&#34; 搭載ボタンで何つくる？〜次々に身近なユースケースが生まれる理由〜</a></p>
<h2 is-upgraded>Appendix</h2>
<h3 is-upgraded>メール送信先の変更</h3>
<p>オペレータのメールアドレス以外のメールアドレスに送信したい場合には、以下の方法で送信先メールアドレスを変更できます。</p>
<h4 is-upgraded>［Menu］&gt;［SIM 管理］とクリックします。</h4>
<p class="image-container"><img style="width: 566.00px" src="img/9da8277c082724ca.png"></p>
<h4 is-upgraded>対象となる SIM (SORACOM LTE-M Button) にチェックを付け、［詳細］をクリックします。</h4>
<p class="image-container"><img style="width: 403.70px" src="img/28eb6ff521e2ed50.png"></p>
<h4 is-upgraded>SIM 詳細で［タグ］をクリックし、その後［＋］をクリックします。</h4>
<p class="image-container"><img style="width: 602.00px" src="img/d45ad3f88f8c029c.png"></p>
<h4 is-upgraded>タグの編集で以下の通り入力します。</h4>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>設定値</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>備考</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>名前</p>
</td><td colspan="1" rowspan="1"><p><code>mail_to</code></p>
</td><td colspan="1" rowspan="1"><p>―</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>値</p>
</td><td colspan="1" rowspan="1"><p>(送信先メールアドレス)</p>
</td><td colspan="1" rowspan="1"><p>間違えないように気を付けてください</p>
</td></tr>
</table>
<p class="image-container"><img style="width: 602.00px" src="img/88a830e02a3d18eb.png"></p>
<p>最後に保存を押します。これで送信先メールアドレスの変更が出来ましたので、ボタンを押して送信してみましょう。</p>
<h3 is-upgraded>メール本文のカスタマイズ方法</h3>
<p>SORACOM Air for Cellular 設定のメタデータにおける「ユーザーデータ」がメール本文となります。</p>
<p>ユーザーデータの１行目は件名として使われ、２行目以降が本文となります。また、2行目以降の本文でHTMLタグを入れると自動的に HTML メールとなります。</p>
<p>本文中に <code>&#123;&#123;event.clickTypeName}}</code> などと書く事によって、メールの中に様々な情報を差し込むことが出来ます。利用可能なパラメータは、ユーザーデータ未設定時やメタデータのスイッチが OFF の場合に送信されるデフォルトのメールに記載があります。</p>
<p>デフォルトのメール本文は以下の通りです。</p>
<pre>ボタン 7MF6J01234567890 が SINGLE クリックされました

- バッテリー残量: 100 % 
- 位置情報:  緯度,経度 = 35.67026205900455,139.74446296691895

--
以下の情報はメールテンプレートで &#123;&#123;event.xxx}} &#123;&#123;context.xxx}} &#123;&#123;tags.xxx}} &#123;&#123;etc.xxx}} のように参照できます

event:
  clickType: 1
  clickTypeName: &#34;SINGLE&#34;
  BatteryLevel: 1
  BatteryLevelPercent: 100

context:
  imsi: 440527777777777
  imei: 359567777777777
  operatorId: &#34;OP0123456789&#34;
  location:
    lat: 35.67026205900455
    lon: 139.74446296691895

tags:
  name: &#34;7MF6J01234567890&#34;
  mail_to: &#34;&#34; (未設定の場合は空欄) 

etc:
  timestamp: &#34;2020/05/16 09:51:11 JST&#34;
  timestampUtc: &#34;2020/05/15 00:51:11 UTC&#34;
  unixtime: 1589590271.554126</pre>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://soracom.github.io/iot-recipes/codelab-elements/native-shim.js"></script>
  <script src="https://soracom.github.io/iot-recipes/codelab-elements/custom-elements.min.js"></script>
  <script src="https://soracom.github.io/iot-recipes/codelab-elements/prettify.js"></script>
  <script src="https://soracom.github.io/iot-recipes/codelab-elements/codelab-elements.js"></script>

</body>
</html>
