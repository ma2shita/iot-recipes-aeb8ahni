
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>【IoT DIY レシピ】Wio LTE と光センサーで作る「テレビの付けっ放しを確認しよう」</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://soracom.github.io/iot-recipes/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-66865146-33"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="tv-power-monitoring-by-wio-lte-light-sensor"
                  title="【IoT DIY レシピ】Wio LTE と光センサーで作る「テレビの付けっ放しを確認しよう」"
                  environment="web"
                  feedback-link="https://soracom.jp/products/kit/grovestarter_kit_lte/">
    
      <google-codelab-step label="Wio LTE と光センサーで作る「テレビの付けっ放しを確認しよう」" duration="1">
        <p>レシピ難易度：★★★★☆</p>
<p>光センサーを活用して「テレビの ON/OFF が確認できるデバイス」を作り、長時間のテレビのつけっぱなしを知る、そしてアラートをする仕組みを作ります。センサーを制御するマイコンには LTE モデム搭載済みプロトタイプ向けデバイス Wio LTE JP Version を使い、どのような場所からでもクラウド通信できるデバイスとして作り上げます。</p>
<p class="image-container"><img style="width: 602.00px" src="img/a1ac19b9b804b501.gif"></p>
<h2 is-upgraded>本レシピを行うのに必要な時間、概算費用</h2>
<p>本レシピは以下の通りです。</p>
<ul>
<li>必要な時間: 約2時間</li>
<li>概算費用: 約16,500円</li>
</ul>
<p>※ 概算費用: ハードウェアや SORACOM を始めとした各種サービスの概ねの費用 (税や送料などの付帯費用や無料枠適用は考慮しないものとしています)</p>
<h2 is-upgraded>このコンテンツの進め方</h2>
<p>ページの内容を読み、また作業を行ったら右下の［Next］を押して次のステップへ進みます。また、［Back］を使って戻ったり、左のナビゲーションメニューでもページの移動が可能です。</p>
<p>左上の［×］を押してコンテンツを終了することができます。また、ページを開きなおすことで再開できます。ページのアドレスはブラウザの［履歴］メニューを利用してください。</p>

<aside class="warning"><p>本コンテンツは現状のままで提供され、株式会社ソラコムは、誤りがないことの保証を含め、明示であると黙示であるとを問わず、本コンテンツの記載内容につき、いかなる種類の表明も保証も行いません。</p>
<p>掲載情報の閲覧及び利用により、利用者自身、もしくは第三者が被った損害に対して、直接的、間接的を問わず、株式会社ソラコムは責任を負いかねます。</p>
<p>本コンテンツを実践する中で用意された機器、利用されたサービスについてのご質問は、それぞれの機器やサービスの提供元にお問い合わせをお願いします。機器やサービスの仕様は、本コンテンツ作成当時のものです。</p>
<p>株式会社ソラコムが提供する機器・サービスについてのご質問は、 <a href="https://soracom.jp/contact/" target="_blank">https://soracom.jp/contact/</a> をご確認の上、適切な窓口へのお問い合わせをお願いします。機器・サービスご利用前の導入相談は <a href="https://soracom.jp/contact/contactsales/" target="_blank">https://soracom.jp/contact/contactsales/</a> に、機器・サービスご利用開始後のサポートは、SORACOMユーザーコンソール内の<a href="https://soracom.zendesk.com/hc/ja/requests/" target="_blank">サポートサイトから「リクエストを送信」</a>(要ログイン)にてお問い合わせください。</p>
<p>本ドキュメントは <a href="https://github.com/googlecodelabs/tools" target="_blank">CLaaT</a> を用いて制作しています</p>
<p>Copyright (c) 2020 SORACOM, INC.</p>
</aside>



      </google-codelab-step>
    
      <google-codelab-step label="準備" duration="1">
        <p>本レシピを行うためには以下のものをご用意ください。</p>
<h2 is-upgraded>ハードウェア</h2>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>品名</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>数量</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>価格</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>購入先</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>備考</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Grove IoT スターターキット for SORACOM(Wio LTE JP Version)</p>
</td><td colspan="1" rowspan="1"><p>1</p>
</td><td colspan="1" rowspan="1"><p>15,980円</p>
</td><td colspan="1" rowspan="1"><p><a href="https://soracom.jp/products/kit/grovestarter_kit_lte/" target="_blank">ソラコム</a></p>
</td><td colspan="1" rowspan="1"><p>キットの中には以下のものが含まれています。(それぞれを個別に準備しても構いません)</p>
<ul>
<li><a href="https://soracom.jp/products/module/wio_lte/" target="_blank">Wio LTE JP Version</a> x 1</li>
<li><a href="https://soracom.jp/products/sim/plan-d/" target="_blank">SORACOM 特定地域向け IoT SIM (plan-D / データ通信のみ / nanoSIM サイズ)</a> x 1</li>
<li>microUSB ケーブル x 1</li>
</ul>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Grove 光センサーモジュール (v1.2)</p>
</td><td colspan="1" rowspan="1"><p>1</p>
</td><td colspan="1" rowspan="1"><p>440円</p>
</td><td colspan="1" rowspan="1"><p><a href="https://www.switch-science.com/catalog/3284/" target="_blank">スイッチサイエンス</a> 等</p>
</td><td colspan="1" rowspan="1"><p>―</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>開発用パソコン</p>
</td><td colspan="1" rowspan="1"><p>1</p>
</td><td colspan="1" rowspan="1"><p>―</p>
</td><td colspan="1" rowspan="1"><p>―</p>
</td><td colspan="1" rowspan="1"><ul>
<li>インターネット接続が可能でサイトへの接続が自由であること。</li>
<li>USB Type-A ポートが最低1つ以上用意出来ること。</li>
<li>USB ポートからの電力供給が1A以上であること。</li>
<li>OS は macOS(10.11 El Capitan 以上) もしくは Windows(8.1 以上)。</li>
<li>管理者権限を有しており、アプリケーションやドライバソフトウェアのインストールが自由であること。</li>
<li>Arduino IDE と Wio LTE JP Version 開発環境が整っていること (セットアップ方法は 【SORACOM ハンズオン】Wio LTE 開発環境セットアップ (<a href="https://soracom.github.io/iot-recipes/setup-for-wiolte-with-arduino-ide-windows/" target="_blank">Windows 編</a> / <a href="https://soracom.github.io/iot-recipes/setup-for-wiolte-with-arduino-ide-macos/" target="_blank">macOS 編</a>) 全体で約90分)をご覧ください)</li>
</ul>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>(必要な方のみ)</p>
<p>USB 変換アダプタ</p>
</td><td colspan="1" rowspan="1"><p>―</p>
</td><td colspan="1" rowspan="1"><p>―</p>
</td><td colspan="1" rowspan="1"><p>―</p>
</td><td colspan="1" rowspan="1"><p>Wio LTE とパソコンを USB ケーブルで接続する際に利用します。</p>
<p>パソコンに USB Type-A ポートがない場合はご用意ください。</p>
<p>1A 以上の電力が供給できるものを利用してください。(USB 3.0以上に対応していれば概ね安心です)</p>
</td></tr>
</table>
<p>※1 ※ 金額はレシピ作成時となります。ソラコムで販売している金額は税抜き・送料別です。</p>
<h2 is-upgraded>その他必要なもの</h2>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>必要なもの</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>費用</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>作成方法など</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>SORACOM アカウント</p>
</td><td colspan="1" rowspan="1"><p>無料※</p>
</td><td colspan="1" rowspan="1"><p><a href="https://soracom.github.io/iot-recipes/create-account-soracom-jp/" target="_blank">SORACOM アカウントの作成 (JP)</a></p>
</td></tr>
</table>
<p>※ アカウント作成・維持の費用の料金です。</p>
<h2 is-upgraded>Wio LTE JP Version 設置用部材</h2>
<p>本レシピ内では Wio LTE JP Version とGrove 超音波距離センサーモジュールを設置するための部材を紹介しています。ここに記載されているものは任意であり、特に準備をせずともレシピ自体は進めることができます。</p>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>品名</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>数量</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>購入先</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>備考</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>黒紙</p>
</td><td colspan="1" rowspan="1"><p>1</p>
</td><td colspan="1" rowspan="1"><p>―</p>
</td><td colspan="1" rowspan="1"><p>光センサーの周りを囲い、環境光が入らないようにします。</p>
<p>コピー用紙を黒ペンで塗りつぶしたものでも構いませんが、紙は厚めが望ましいです。</p>
<p>サイズは3cm四方もあれば問題ないでしょう。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>養生テープ等の幅広の物</p>
</td><td colspan="1" rowspan="1"><p>―</p>
</td><td colspan="1" rowspan="1"><p><a href="https://www.amazon.co.jp/dp/B004OQZY4I/" target="_blank">Amazon.co.jp</a> 等</p>
</td><td colspan="1" rowspan="1"><p>光センサーをテレビに取り付ける際に利用しました。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>電源用 microUSB ケーブル、および AC アダプタ</p>
</td><td colspan="1" rowspan="1"><p>1</p>
</td><td colspan="1" rowspan="1"><p>―</p>
</td><td colspan="1" rowspan="1"><p>開発に使用するケーブルとは別に、テレビに取り付けて運用する際に別途準備ください。</p>
<p><a href="https://www.switch-science.com/catalog/5215/" target="_blank">長めの Grove ケーブル</a>を用意しても可です。</p>
</td></tr>
</table>


      </google-codelab-step>
    
      <google-codelab-step label="光センサーの動作を確認する" duration="15">
        <p>光センサーと Wio LTE JP Version (以下 Wio LTE) のみで、まずは動作を確認してみます。</p>
<h2 is-upgraded>事前の確認</h2>
<p>開発用パソコンに下の準備が整っているか確認します。整っていない場合は、先にセットアップを済ませてから、作業を続けることになります。</p>
<ul>
<li>Arduino IDE のセットアップ (済んでいない場合は <a href="https://soracom.github.io/iot-recipes/arduino-ide-windows" target="_blank">Windows 編</a> もしくは <a href="https://soracom.github.io/iot-recipes/arduino-ide-macos" target="_blank">macOS 編</a>の作業を行ってください。約20分の作業です。)</li>
<li>Wio LTE 開発環境のセットアップ (済んでいない場合は <a href="https://soracom.github.io/iot-recipes/setup-for-wiolte-with-arduino-ide-windows" target="_blank">Windows 編</a> もしくは <a href="https://soracom.github.io/iot-recipes/setup-for-wiolte-with-arduino-ide-macos" target="_blank">macOS 編</a>の作業を行ってください。約70分の作業です。)</li>
</ul>
<h2 is-upgraded>Wio LTE に光センサーモジュールを接続する</h2>
<p>外観は以下の通りです。</p>
<table>
<tr><td colspan="1" rowspan="1"><p>光センサーモジュール</p>
</td><td colspan="1" rowspan="1"><p class="image-container"><img style="width: 261.00px" src="img/d6c509744cefbae4.png"></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Wio LTE</p>
</td><td colspan="1" rowspan="1"><p class="image-container"><img style="width: 353.00px" src="img/8e2fbaa79701df5d.png"></p>
</td></tr>
</table>
<p>Wio LTE の接続先は A6 です。ボード上に &#34;A6&#34; と書いてあるのを確認したうえで、接続してください。(D38 ではありません、ご注意ください。)</p>
<p class="image-container"><img style="width: 602.00px" src="img/9b4c6c8bbab29097.png"></p>
<aside class="warning"><p><strong>ケーブルはどれを使えば良い？</strong></p>
<p>光センサーモジュールに添付されている Grove ケーブルを使います。Grove IoT スターターキット for SORACOM に付属している Grove ケーブルも利用可能です。その場合、白いトレーの下にケーブルがあります。</p>
</aside>
<h2 is-upgraded>ライブラリのインストール</h2>
<p>必要なライブラリをインストールします。光センサー自体は標準関数 (<code>analogRead()</code>) で動作しますが、設定情報のやり取りやクラウドとの通信に使用する JSON を容易に扱えるライブラリ <a href="https://arduinojson.org/" target="_blank">ArduinoJson</a> を使用します。</p>
<h3 is-upgraded>［スケッチ］&gt;［ライブラリをインクルード］&gt;［ライブラリを管理...］をクリックします</h3>
<p class="image-container"><img style="width: 602.00px" src="img/41f6da411abfe840.png"></p>
<p>※ 画面は macOS ですが、Windows も同様です。</p>
<h3 is-upgraded>&#34;ArduinoJson&#34; をインストールする</h3>
<p>ライブラリマネージャの一覧から <strong>ArduinoJson </strong>(by Benoit Blanchon) を選んで［インストール］をクリックします。</p>
<p>バージョンはインストール時における最新バージョンを選んでください。</p>
<p class="image-container"><img style="width: 602.00px" src="img/e73f69c6c7ad6370.png"></p>
<p>インストールが終了したら［閉じる］をクリックします。</p>
<aside class="special"><p><strong>&#34;ArduinoJson&#34; を簡単に探し出す方法</strong></p>
<p>検索用のテキストボックスへ <code>arduinojson</code>と入力すると素早く見つけることができます。</p>
<p class="image-container"><img style="width: 587.00px" src="img/5851ec15421dc596.png"></p>
</aside>
<h2 is-upgraded>光センサーの動作を確認するスケッチ</h2>
<p>Arduino IDE を起動し［ファイル］&gt;［新規ファイル］を開くと <code>void setup() {</code> から始まる「空のスケッチ」が表示されます。</p>
<p>一度スケッチの内容を削除してから、後述のスケッチで置き換えてください。</p>
<p class="image-container"><img style="width: 793.80px" src="img/79a736d5bbc2669c.png"></p>
<h3 is-upgraded><a href="https://gist.githubusercontent.com/ma2shita/0e5e0cba42b06114ec6a96dbd6fa0318/raw/f6a3a097e5df85703f8ec5503914e0c3defc4865/lets_try_iot_grove_light_local.ino" target="_blank">lets_try_iot_grove_light_local.ino</a></h3>
<pre><code>/* See: https://www.lp.soracom.jp/202005-online-seminar/ */
/*
 * TV power monitor (using Light sensor) / Local sensing only version
 * 
 * Copyright (c) 2020 SORACOM, INC.
 * Released under the MIT license
 * https://opensource.org/licenses/mit-license.php
*/

#include &lt;WioLTEforArduino.h&gt;
WioLTE Wio;
#define console SerialUSB

#include &lt;ArduinoJson.h&gt;
/* global vals for dynamic config by SORACOM Air metadata */
int TV_OFF_THRESHOLD;
int TV_ON_DARK_THRESHOLD;
int TV_ON_BRIGHT_THRESHOLD;
int SAMPLING_COUNT;
int SENSING_INTERVAL_MS;

void setup() {
  delay(3000);
  console.println(&#34;&#34;);
  console.println(&#34;--- START ---&#34;);
  Wio.Init();
  Wio.PowerSupplyGrove(true);
  
  /* set for light sensor */
  pinMode(WIOLTE_A6, INPUT_ANALOG);
  
  /* set for device config */
  String json = &#34;{\&#34;TV_OFF_THRESHOLD\&#34;: 4, \&#34;TV_ON_DARK_THRESHOLD\&#34;: 30, \&#34;TV_ON_BRIGHT_THRESHOLD\&#34;: 200, \&#34;SENSING_INTERVAL_MS\&#34;: 1000, \&#34;SAMPLING_COUNT\&#34;: 1}&#34;;
  console.println(json);
  const size_t capacity = JSON_OBJECT_SIZE(5) + 110; // Code generate by https://arduinojson.org/v6/assistant/
  DynamicJsonDocument doc(capacity);
  deserializeJson(doc, json); // NOTE: Need error handling
  /* read from JSON */
  TV_OFF_THRESHOLD = doc[&#34;TV_OFF_THRESHOLD&#34;];
  console.print(&#34;TV OFF threshold is &#34;);
  console.println(TV_OFF_THRESHOLD);
  SENSING_INTERVAL_MS = doc[&#34;SENSING_INTERVAL_MS&#34;];
  console.print(&#34;Sensing interval is every &#34;);
  console.print(SENSING_INTERVAL_MS / 1000.0);
  console.println(&#34; seconds&#34;);
  SAMPLING_COUNT = doc[&#34;SAMPLING_COUNT&#34;];
  console.print(&#34;Send interval is every &#34;);
  console.print(SAMPLING_COUNT * SENSING_INTERVAL_MS / 1000.0);
  console.println(&#34; seconds&#34;);
  TV_ON_DARK_THRESHOLD = doc[&#34;TV_ON_DARK_THRESHOLD&#34;];
  TV_ON_BRIGHT_THRESHOLD = doc[&#34;TV_ON_BRIGHT_THRESHOLD&#34;];
}

void sensing_data_display(WioLTE &amp;wio, int analogRead_val) {
  if (analogRead_val &lt;= TV_OFF_THRESHOLD) {
    Wio.LedSetRGB(1, 0, 0); /* RED when OFF the TV */
  } else if (analogRead_val &lt;= TV_ON_DARK_THRESHOLD) {
    Wio.LedSetRGB(0, 1, 0); /* GREEN */
  } else if (analogRead_val &lt;= TV_ON_BRIGHT_THRESHOLD) {
    Wio.LedSetRGB(0, 0, 1); /* BLUE */
  } else {
    Wio.LedSetRGB(1, 1, 1); /* WHITE when over bright */
  }
}

#include &lt;vector&gt;
std::vector&lt;int&gt; v;
#include &lt;algorithm&gt;

void loop() {
  int val = analogRead(WIOLTE_A6);
  sensing_data_display(Wio, val);
  v.push_back(val);
  
  console.print(v.size()); console.print(&#34; &#34;);
  if (SAMPLING_COUNT &lt;= v.size()) { // aggregation and send to cloud
    console.println();
    console.println(&#34;---&#34;);
    for (auto itr = v.begin(); itr != v.end(); ++itr) { console.println(*itr); }
    console.println(&#34;---&#34;);
    auto power_on_count = std::count_if(v.begin(), v.end(), [](int x) { return TV_OFF_THRESHOLD &lt; x; });
    console.println(power_on_count);
    float power_on_rate = (float) power_on_count / (float) v.size();
    console.println(power_on_rate);
    v.clear();
    /* build to JSON */
    const size_t capacity = JSON_OBJECT_SIZE(1); // Code generate by https://arduinojson.org/v6/assistant/
    DynamicJsonDocument doc(capacity);
    doc[&#34;power_on_rate&#34;] = power_on_rate;
    char buf[1024];
    serializeJson(doc, buf);
    console.println(buf);
  }
  
  delay(SENSING_INTERVAL_MS);
}</code></pre>
<h2 is-upgraded>マイコンボードに書き込む</h2>
<p>Arduino IDE で<img style="width: 33.00px" src="img/6eda9a3a4a4958d7.png">ボタンをクリックします。<strong>ボードへの書き込みが完了しました。</strong>と表示されたら正常終了です。</p>
<aside class="special"><p><strong>ファイルの保存ダイアログが表示されたら</strong></p>
<p>ファイルを保存してください。ファイル名は任意ですが <code>lets_try_iot_grove_light_local</code> というファイル名はどうでしょうか。</p>
<p>ファイルを保存しない (キャンセル) してもコンパイルとスケッチの転送はされます。</p>
</aside>
<h2 is-upgraded>実行の様子</h2>
<p>光センサーモジュールの透明の部分がセンサー本体です。そこを手で覆い隠すと LED が赤 (= 暗い) と判定されたり、手を広げて光が取り込まれると、緑→青→白と変化していきます。LED の色は明るさに対応しており、暗い方から赤→緑→青→白となります。</p>
<p class="image-container"><img style="width: 602.00px" src="img/a1ac19b9b804b501.gif"></p>


      </google-codelab-step>
    
      <google-codelab-step label="SORACOM Harvest Data でデータを蓄積する (アンテナ・SIM の取り付け)" duration="10">
        <h2 is-upgraded>Wio LTE にアンテナを取り付ける</h2>
<p><strong>注意:</strong> Wio LTE から microUSB ケーブルを抜いた状態にしてください。</p>
<p>Wio LTE に 添付されているアンテナ2本を取り付けます (※アンテナは必ず2本取り付けてください)</p>
<p class="image-container"><img style="width: 602.00px" src="img/3aee1bad6ea914ac.png"></p>
<h2 is-upgraded>Wio LTE に SIM を取り付ける</h2>
<p>Wio LTE に SIM (nanoサイズ) を取り付けます。</p>
<p><strong>最初に「失敗例」を紹介します。</strong></p>
<p>以下のように、SIM 取り付けの「窓」に SIM が見えている場合は<strong>取り付けに失敗しています</strong>。引き抜いてから再度取り付けてください。</p>
<p class="image-container"><img style="width: 414.00px" src="img/fb7f40017c726f7e.png"></p>
<h3 is-upgraded>ここからは「<strong>正しい取り付け方</strong>」です。</h3>
<p class="image-container"><img style="width: 536.00px" src="img/6ac34390f775eaf6.png"></p>
<p class="image-container"><img style="width: 474.00px" src="img/9a810d214932deca.png"></p>
<aside class="special"><p><strong>SIM の取り出し方</strong></p>
<p class="image-container"><img style="width: 587.00px" src="img/b7fd3a522c52e6ba.png"></p>
<p class="image-container"><img style="width: 509.00px" src="img/b4a8401f22bb6c57.png"></p>
<p><strong>抜く際フックを引っ張りすぎると金具が取れてしまうため</strong>、図示されている程度まで引っ張り出したらSIMを取り出し、金具を元に戻してください。</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="SORACOM Harvest Data でデータを蓄積する (グループの作成)" duration="10">
        <p>SORACOM の IoT データ収集・蓄積サービス <a href="https://soracom.jp/services/harvest/" target="_blank"><strong>SORACOM Harvest Data</strong></a> を利用して、データの可視化を簡単に実現してみましょう。</p>
<p>まずは<strong>グループ</strong>の作成と、作成したグループへ SIM を所属させる事から始めます。</p>
<aside class="special"><p><strong>SORACOM Harvest Data とは？</strong></p>
<p>IoT デバイスからのデータの収集や蓄積、およびファイルを保存するサービスが SORACOM Harvest (ソラコム ハーベスト) です。IoT デバイスからのデータの収集・蓄積対応しているのが SORACOM Harvest Data、画像ファイルやログファイルといったファイルに対応しているのが SORACOM Harvest Files となります。</p>
</aside>
<aside class="special"><p><strong>グループとは？</strong></p>
<p>SORACOM サービスのほとんどが<strong>グループ</strong>という単位に対して設定するようになっています。SORACOM Harvest Data 等、SORACOM サービスのほとんどが SIM に直接設定をするのではなくグループに設定をします。そして、SIM をグループに所属させることで SORACOM サービスが利用できるという間接的な仕組みです。<img style="width: 587.00px" src="img/a9af1cef0f747a1d.png"></p>
<p>グループを作成してから SIM を所属させる方法の他、グループの作成と SIM の所属を同時に行う方法もあります。本レシピでは後者の「同時に行う」手順で進めていきます。</p>
</aside>
<h2 is-upgraded><a href="https://console.soracom.io/" target="_blank">SORACOM ユーザーコンソール</a>にログインした後［Menu］&gt;［SIM 管理］とクリックして SIM 管理画面を開きます。</h2>
<p class="image-container"><img style="width: 566.00px" src="img/c4968675c5a9a1c8.png"></p>
<aside class="warning"><p><strong>［SIM 管理］をクリックしても画面が切り替わらない場合は？</strong></p>
<p>すでに SIM 管理画面を開いている場合は、［SIM 管理］をクリックしても画面が切り替わることがありません。その場合、青の点線で囲まれている「SORACOM ロゴ」をクリックすることでメニューを閉じることができます。</p>
</aside>
<h2 is-upgraded>SORACOM Harvest Data でデータの収集を行いたい SIM (Wio LTE に取り付けた SIM) にチェックを付け、［操作］&gt;［所属グループ変更］とクリックします。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/f27d0ddf2224ee5f.png"></p>
<aside class="special"><p><strong>SORACOM の便利な使い方: 複数の SIM を同時に扱う</strong></p>
<p>チェックをつける対象を複数にすれば、一度の複数の SIM を対象に操作が可能です。</p>
</aside>
<h2 is-upgraded>「新しい所属グループ」のプルダウンボックスをクリックした後、［新しいグループを作成...］をクリックします。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/9cf95365d7028f2c.png"></p>
<h2 is-upgraded>「グループ作成」のグループ名を入力して［グループ作成］をクリックします。</h2>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>例</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>備考</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>グループ名</p>
</td><td colspan="1" rowspan="1"><p><code>tv-power-monitor</code></p>
</td><td colspan="1" rowspan="1"><p>自由に入力可能です。日本語も設定可能です。</p>
</td></tr>
</table>
<p class="image-container"><img style="width: 385.00px" src="img/1458427b4d13fc88.png"></p>
<h2 is-upgraded>新しい所属グループが先ほど作成したグループになっていることを確認したら［グループ変更］をクリックします。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/ed69723c329bb27.png"></p>
<h2 is-upgraded>自動的に SIM 管理画面に戻ります。<br>SIM の「グループ」に先ほど作ったグループが設定されていることを確認してください。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/8880dc4a2175da53.png"></p>
<p>以上で、グループの作成と所属の作業は完了です。</p>


      </google-codelab-step>
    
      <google-codelab-step label="SORACOM Harvest Data でデータを蓄積する (グループの設定)" duration="5">
        <p>グループに「<strong>SORACOM Harvest Data</strong>」の3つの設定を行います。</p>
<h2 is-upgraded>SIM 管理画面から、Wio LTE に割り当てたグループ名をクリックします。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/e25dea9cd2d1a6e6.png"></p>
<h2 is-upgraded>［SORACOM Air for Cellular 設定］をクリックして設定が出来るように開きます。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/b998b07a00552e4a.png"></p>
<h2 is-upgraded>「SORACOM Air for Cellular 設定」で以下のように設定します。</h2>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>設定値</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>備考</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>メタデータサービス設定（スイッチ）</p>
</td><td colspan="1" rowspan="1"><p>ON</p>
</td><td colspan="1" rowspan="1"><p>スイッチはクリックすることで OFF から ON に切り替えることができます</p>
</td></tr>
</table>
<p>※ その他の項目の変更や編集は不要です。</p>
<p class="image-container"><img style="width: 262.00px" src="img/a791e816f65824dd.png"><br></p>
<p>最後に［保存］をクリックしてください。また、同じページ内での設定が続くため、ページは閉じないでください。</p>
<h2 is-upgraded>［SORACOM Harvest Data 設定］をクリックして設定ができるように開きます。</h2>
<p>先ほどの設定を行ったページ内にあります。</p>
<p class="image-container"><img style="width: 602.00px" src="img/7628690cf5f7b17e.png"></p>
<h2 is-upgraded>「SORACOM Harvest Data 設定」で以下のように設定します。</h2>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>設定値</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>備考</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>（スイッチ）</p>
</td><td colspan="1" rowspan="1"><p>ON</p>
</td><td colspan="1" rowspan="1"><p>スイッチはクリックすることで OFF から ON に切り替えることができます。</p>
</td></tr>
</table>
<p class="image-container"><img style="width: 262.00px" src="img/b8dd4f4f9fc5f281.png"></p>
<p>最後に［保存］をクリックしてください。<br>その後表示される「SORACOM Harvest Data が有効になっています」のダイアログでは［OK］をクリックしてください。</p>
<p>以上で「SORACOM Ai メタデータサービス」と「SORACOM Harvest Data」の設定が完了しました。</p>


      </google-codelab-step>
    
      <google-codelab-step label="SORACOM Harvest Data でデータを蓄積する (メタデータの設定)" duration="5">
        <aside class="special"><p><strong>メタデータとは？</strong></p>
<p>通信回線(SIM)に関するデータで、回線管理のために使用します。たとえば SIM を一意に識別することができる IMSI といった静的な情報から、現在の通信状況や回線速度といった動的な情報を取得することができます。また、ユーザー自身によって回線に対して「タグ付け」が可能です。タグは名前(キー)と値(バリュー)の対になっており、たとえば「使用部門」というキーを作り、その値に「開発部」と設定が可能です。設定だけでは無く、API によって読み出すこともできる他、SORACOM IoT SIM を使った回線からであれば、SIM によって認証が完了しているため、自 SIM の情報は認証なしで取得・更新可能となっています。</p>
</aside>
<h2 is-upgraded>SORACOM ユーザーコンソールの［Menu］&gt;［SIM 管理］とクリックして SIM 管理画面を開きます。</h2>
<p class="image-container"><img style="width: 566.00px" src="img/c4968675c5a9a1c8.png"></p>
<aside class="warning"><p><strong>［SIM 管理］をクリックしても画面が切り替わらない場合は？</strong></p>
<p>すでに SIM 管理画面を開いている場合は、［SIM 管理］をクリックしても画面が切り替わることがありません。その場合、青の点線で囲まれている「SORACOM ロゴ」をクリックすることでメニューを閉じることができます。</p>
</aside>
<h2 is-upgraded>メタデータを設定したい SIM (Wio LTE に取り付けた SIM) にチェックを付け、［詳細］をクリックします。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/c534d9f67194162f.png"></p>
<aside class="warning"><p>「詳細」は複数チェックによる操作ができないため、複数行いたい場合は一つづつ行います。</p>
</aside>
<h2 is-upgraded>「SIM 詳細」で［タグ］&gt;<img style="width: 52.00px" src="img/beddcc116acb43a.png">をクリックします。</h2>
<p class="image-container"><img style="width: 779.50px" src="img/e81b572250669d08.png"></p>
<h2 is-upgraded>「タグの編集」で以下のように設定します。</h2>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>設定値</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>名前</p>
</td><td colspan="1" rowspan="1"><p><code>config_json</code></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>値</p>
</td><td colspan="1" rowspan="1"><p><code>{&#34;TV_OFF_THRESHOLD&#34;: 4, &#34;TV_ON_DARK_THRESHOLD&#34;: 30, &#34;TV_ON_BRIGHT_THRESHOLD&#34;: 200, &#34;SENSING_INTERVAL_MS&#34;: 1000, &#34;SAMPLING_COUNT&#34;: 10}</code></p>
</td></tr>
</table>
<p>※1行で入力してください。</p>
<p class="image-container"><img style="width: 602.00px" src="img/43e10c7bbec105de.png"></p>
<p>最後に［保存］をクリックし、「SIM 詳細」では［閉じる］をクリックしてください。</p>
<p>これで、SIM に対してタグ付けが完了しました。</p>
<aside class="special"><p><strong>設定値の意味</strong></p>
<ul>
<li><code>TV_OFF_THRESHOLD</code> : 光センサーの値がこの値よりも下だった場合は、 TV 画面が消えていると判定します</li>
<li><code>TV_ON_BRIGHT_THRESHOLD</code> : 光センサーの値がこの値よりも上だった場合は、 TV 画面が点いている判定します</li>
</ul>
<p>この二つの値を調整することで、Wio LTE の動作を環境に合わせることができます。</p>
<p>この設定は Wio LTE の起動時に読み込まれるため、変更をしたら Wio LTE の電源を入れ直すようにしてください。</p>
<p>その他の値の意味は <a href="https://docs.google.com/presentation/d/1eBG_fJIv4PCCXM73SuGIJuBD21-lSFTBDZObi-TPpR0/edit?usp=sharing" target="_blank">Google スライド</a> の図解と共に確認ください。</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="SORACOM Harvest Data でデータを蓄積する (スケッチの作成から確認まで)" duration="10">
        <p>Arduino IDE を起動し［ファイル］&gt;［新規ファイル］を開くと <code>void setup() {</code> から始まる「空のスケッチ」が表示されます。</p>
<p>一度スケッチの内容を削除してから、下記スケッチで置き換えてください。</p>
<h3 is-upgraded><a href="https://gist.githubusercontent.com/ma2shita/14ce40affe4b4a56bffc265d67b1b1b8/raw/c129bc972a5a80269a2a71d310d8c22f5f40d450/lets_try_iot_grove_light_lte.ino" target="_blank">lets_try_iot_grove_light_lte.ino</a></h3>
<pre><code>/* See: https://www.lp.soracom.jp/202005-online-seminar/ */
/*
 * TV power monitor (using Light sensor) / with LTE
 * 
 * Copyright (c) 2020 SORACOM, INC.
 * Released under the MIT license
 * https://opensource.org/licenses/mit-license.php
*/

#include &lt;WioLTEforArduino.h&gt;
WioLTE Wio;
#define console SerialUSB

String get_metadata_by(WioLTE &amp;wio, const char* tag_key, const char* default_value = &#34;&#34;) {
  char url[1024];
  sprintf(url, &#34;http://metadata.soracom.io/v1/subscriber.tags.%s&#34;, tag_key);
  char buf[1024];
  wio.HttpGet(url, buf, sizeof(buf));
  String content = String(buf);
  content.trim();
  if (content == &#34;Specified key does not exist.&#34; || /* == 404 */
      content == &#34;You are not allowed to access Metadata Server.&#34;) { /* == 403 */
      content = String(default_value);
      content.trim();
  }
  return content;
}

#include &lt;ArduinoJson.h&gt;
/* global vals for dynamic config by SORACOM Air metadata */
int TV_OFF_THRESHOLD;
int TV_ON_DARK_THRESHOLD;
int TV_ON_BRIGHT_THRESHOLD;
int SAMPLING_COUNT;
int SENSING_INTERVAL_MS;

void setup() {
  delay(3000);
  console.println(&#34;&#34;);
  console.println(&#34;--- START ---&#34;);
  Wio.Init();
  Wio.PowerSupplyGrove(true);
  console.println(&#34;### Power supply ON.&#34;);
  Wio.PowerSupplyLTE(true);
  delay(500);
  console.println(&#34;### Turn on or reset.&#34;);
  if (!Wio.TurnOnOrReset()) {
    console.println(&#34;### ERROR! ###&#34;);
    return;
  }
  console.println(&#34;### Connecting to \&#34;soracom.io\&#34;.&#34;);
  if (!Wio.Activate(&#34;soracom.io&#34;, &#34;sora&#34;, &#34;sora&#34;)) {
    console.println(&#34;### ERROR! ###&#34;);
    return;
  }
  
  /* set for light sensor */
  pinMode(WIOLTE_A6, INPUT_ANALOG);
  
  /* set for device config */
  // Template for metadata: {&#34;TV_OFF_THRESHOLD&#34;: 4, &#34;TV_ON_DARK_THRESHOLD&#34;: 30, &#34;TV_ON_BRIGHT_THRESHOLD&#34;: 200, &#34;SENSING_INTERVAL_MS&#34;: 1000, &#34;SAMPLING_COUNT&#34;: 10}
  String json = get_metadata_by(Wio, &#34;config_json&#34;);
  console.println(json);
  const size_t capacity = JSON_OBJECT_SIZE(5) + 110; // Code generate by https://arduinojson.org/v6/assistant/
  DynamicJsonDocument doc(capacity);
  deserializeJson(doc, json); // NOTE: Need error handling
  /* read from JSON */
  TV_OFF_THRESHOLD = doc[&#34;TV_OFF_THRESHOLD&#34;];
  console.print(&#34;TV OFF threshold is &#34;);
  console.println(TV_OFF_THRESHOLD);
  SENSING_INTERVAL_MS = doc[&#34;SENSING_INTERVAL_MS&#34;];
  console.print(&#34;Sensing interval is every &#34;);
  console.print(SENSING_INTERVAL_MS / 1000.0);
  console.println(&#34; seconds&#34;);
  SAMPLING_COUNT = doc[&#34;SAMPLING_COUNT&#34;];
  console.print(&#34;Send interval is every &#34;);
  console.print(SAMPLING_COUNT * SENSING_INTERVAL_MS / 1000.0);
  console.println(&#34; seconds&#34;);
  TV_ON_DARK_THRESHOLD = doc[&#34;TV_ON_DARK_THRESHOLD&#34;];
  TV_ON_BRIGHT_THRESHOLD = doc[&#34;TV_ON_BRIGHT_THRESHOLD&#34;];
}

void sensing_data_display(WioLTE &amp;wio, int analogRead_val) {
  if (analogRead_val &lt;= TV_OFF_THRESHOLD) {
    Wio.LedSetRGB(1, 0, 0); /* RED when OFF the TV */
  } else if (analogRead_val &lt;= TV_ON_DARK_THRESHOLD) {
    Wio.LedSetRGB(0, 1, 0); /* GREEN */
  } else if (analogRead_val &lt;= TV_ON_BRIGHT_THRESHOLD) {
    Wio.LedSetRGB(0, 0, 1); /* BLUE */
  } else {
    Wio.LedSetRGB(1, 1, 1); /* WHITE when over bright */
  }
}

#include &lt;vector&gt;
std::vector&lt;int&gt; v;
#include &lt;algorithm&gt;

void loop() {
  int val = analogRead(WIOLTE_A6);
  sensing_data_display(Wio, val);
  v.push_back(val);
  
  console.print(v.size()); console.print(&#34; &#34;);
  if (SAMPLING_COUNT &lt;= v.size()) { // aggregation and send to cloud
    console.println();
    console.println(&#34;---&#34;);
    for (auto itr = v.begin(); itr != v.end(); ++itr) { console.println(*itr); }
    console.println(&#34;---&#34;);
    auto power_on_count = std::count_if(v.begin(), v.end(), [](int x) { return TV_OFF_THRESHOLD &lt; x; });
    console.println(power_on_count);
    float power_on_rate = (float) power_on_count / (float) v.size();
    console.println(power_on_rate);
    v.clear();
    /* build to JSON */
    const size_t capacity = JSON_OBJECT_SIZE(1); // Code generate by https://arduinojson.org/v6/assistant/
    DynamicJsonDocument doc(capacity);
    doc[&#34;power_on_rate&#34;] = power_on_rate;
    char buf[1024];
    serializeJson(doc, buf);
    console.println(buf);
    /* send to cloud */
    int http_status_code;
    if (!Wio.HttpPost(&#34;http://unified.soracom.io&#34;, buf, &amp;http_status_code)) {
      console.println(&#34;### ERROR! ###&#34;);
    }
    console.println(http_status_code);
  }
  
  delay(SENSING_INTERVAL_MS);
}</code></pre>
<h3 is-upgraded>参考: 先ほどのスケッチからの変更点</h3>
<pre><code>--- lets_try_iot_grove_light_local/lets_try_iot_grove_light_local.ino   2020-04-27 03:53:28.469203900 +0900
+++ lets_try_iot_grove_light_lte/lets_try_iot_grove_light_lte.ino       2020-04-27 03:53:58.479053500 +0900
@@ -1,6 +1,6 @@
 /* See: https://www.lp.soracom.jp/202005-online-seminar/ */
 /*
- * TV power monitor (using Light sensor) / Local sensing only version
+ * TV power monitor (using Light sensor) / with LTE
  *
  * Copyright (c) 2020 SORACOM, INC.
  * Released under the MIT license
@@ -11,6 +11,21 @@
 WioLTE Wio;
 #define console SerialUSB

+String get_metadata_by(WioLTE &amp;wio, const char* tag_key, const char* default_value = &#34;&#34;) {
+  char url[1024];
+  sprintf(url, &#34;http://metadata.soracom.io/v1/subscriber.tags.%s&#34;, tag_key);
+  char buf[1024];
+  wio.HttpGet(url, buf, sizeof(buf));
+  String content = String(buf);
+  content.trim();
+  if (content == &#34;Specified key does not exist.&#34; || /* == 404 */
+      content == &#34;You are not allowed to access Metadata Server.&#34;) { /* == 403 */
+      content = String(default_value);
+      content.trim();
+  }
+  return content;
+}
+
 #include &lt;ArduinoJson.h&gt;
 /* global vals for dynamic config by SORACOM Air metadata */
 int TV_OFF_THRESHOLD;
@@ -25,12 +40,26 @@
   console.println(&#34;--- START ---&#34;);
   Wio.Init();
   Wio.PowerSupplyGrove(true);
+  console.println(&#34;### Power supply ON.&#34;);
+  Wio.PowerSupplyLTE(true);
+  delay(500);
+  console.println(&#34;### Turn on or reset.&#34;);
+  if (!Wio.TurnOnOrReset()) {
+    console.println(&#34;### ERROR! ###&#34;);
+    return;
+  }
+  console.println(&#34;### Connecting to \&#34;soracom.io\&#34;.&#34;);
+  if (!Wio.Activate(&#34;soracom.io&#34;, &#34;sora&#34;, &#34;sora&#34;)) {
+    console.println(&#34;### ERROR! ###&#34;);
+    return;
+  }

   /* set for device config */
-  String json = &#34;{\&#34;TV_OFF_THRESHOLD\&#34;: 4, \&#34;TV_ON_DARK_THRESHOLD\&#34;: 30, \&#34;TV_ON_BRIGHT_THRESHOLD\&#34;: 200, \&#34;SENSING_INTERVAL_MS\&#34;: 1000, \&#34;SAMPLING_COUNT\&#34;: 1}&#34;;
+  // Template for metadata: {&#34;TV_OFF_THRESHOLD&#34;: 4, &#34;TV_ON_DARK_THRESHOLD&#34;: 30, &#34;TV_ON_BRIGHT_THRESHOLD&#34;: 200, &#34;SENSING_INTERVAL_MS&#34;: 1000, &#34;SAMPLING_COUNT&#34;: 10}
+  String json = get_metadata_by(Wio, &#34;config_json&#34;);
   console.println(json);
   const size_t capacity = JSON_OBJECT_SIZE(5) + 110; // Code generate by https://arduinojson.org/v6/assistant/
   DynamicJsonDocument doc(capacity);

@@ -89,6 +118,12 @@
     char buf[1024];
     serializeJson(doc, buf);
     console.println(buf);
+    /* send to cloud */
+    int http_status_code;
+    if (!Wio.HttpPost(&#34;http://unified.soracom.io&#34;, buf, &amp;http_status_code)) {
+      console.println(&#34;### ERROR! ###&#34;);
+    }
+    console.println(http_status_code);
   }

   delay(SENSING_INTERVAL_MS);</code></pre>
<h2 is-upgraded>マイコンボードに書き込む</h2>
<p>Arduino IDE で<img style="width: 33.00px" src="img/6eda9a3a4a4958d7.png">ボタンをクリックします。<strong>ボードへの書き込みが完了しました。</strong>と表示されたら正常終了です。</p>
<aside class="special"><p><strong>ファイルの保存ダイアログが表示されたら</strong></p>
<p>ファイルを保存してください。ファイル名は任意ですが <code>lets_try_iot_grove_light_lte</code> というファイル名はどうでしょうか。</p>
<p>ファイルを保存しない (キャンセル) してもコンパイルとスケッチの転送はされます。</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="SORACOM Harvest Data で蓄積データを確認する" duration="5">
        <p>Wio LTE からのデータが SORACOM Harvest Data に表示されることを確認してみましょう。</p>
<h2 is-upgraded>［Menu］&gt;［SIM 管理］とクリックして SIM 管理画面を開きます。</h2>
<p class="image-container"><img style="width: 566.00px" src="img/c4968675c5a9a1c8.png"></p>
<h2 is-upgraded>SORACOM Harvest Data でデータの収集を行いたい SIM (Wio LTE に取り付けた SIM) にチェックを付け、［操作］&gt;［データを確認］とクリックします。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/931abc46460b7993.png"></p>
<h2 is-upgraded>表示された画面で［自動更新］を ON にします。</h2>
<p>この表示された画面が SORACOM Harvest Data の画面となります。</p>
<aside class="special"><p><strong>自動更新とは？</strong></p>
<p>画面を再読み込みしなくとも新しいデータが自動的に表示されるようにする機能です。5秒毎に新しいデータを表示するようになります。この機能が OFF の場合は、表示する期間を指定して［検索］をクリックすることで期間内のデータを表示できます。</p>
</aside>
<p class="image-container"><img style="width: 866.50px" src="img/ff288bb36b60c98d.png"></p>
<h2 is-upgraded>Wio LTE を通常モード (RST ボタンを押すか、microUSB ケーブルを抜き挿しする)にしてデータの送信を行ってみます。</h2>
<p>本設定では、光センサーからの値が 4 を超えた場合を「TV の電源がついている」と判定しています。そして、Wio LTE は 1 秒毎に 10 回センサーの値を内部的に保持して (4を超えた回数) / 10 として割合を出しています。その割合を  <code>{&#34;power_on_rate&#34;: 0.5}</code> としてSORACOM Harvest Data に送信しています。</p>
<p class="image-container"><img style="width: 808.50px" src="img/e4378d4cce8dd4d8.png"></p>
<p>以上で全ての作業は終了です。</p>
<p>ここから先は、Wio LTE の設置の様子となります。</p>


      </google-codelab-step>
    
      <google-codelab-step label="取り付けを行う" duration="20">
        <h2 is-upgraded>センサーの遮光を行う</h2>
<p>センサーはあらゆる方向からの光を計測します。今回はテレビからの光のみを計測したいため、横方向からの光を遮るための工作を行います。</p>
<p>縦 25mm 幅 10mm 程度の黒い紙を用意し、その紙を直径 5mm 程度になるように丸めて光センサーの &#34;LIGHT&#34; と書いてある部分にかぶせます。</p>
<p class="image-container"><img style="width: 505.00px" src="img/b51b1102834b8946.png"></p>
<p class="image-container"><img style="width: 417.00px" src="img/10de2d350e2a5edb.png"></p>
<p>これで、横方向から光を遮断するカバーとしています。</p>
<p>黒い紙が無ければ、白紙をサインペンで黒く塗り潰して準備してください。</p>
<h2 is-upgraded>テレビに取り付ける</h2>
<p>テレビからの光がセンサー部に当たるように取り付けます。</p>
<p class="image-container"><img style="width: 602.00px" src="img/6744ae67dee4fac9.png"></p>
<p>密着できるのが最適ですが、そうでなかったとしてもメタデータに格納したパラメーターを調整することで TV の画面が点いている／消えているを判定させることが可能です。</p>
<p>パラメータについては、特に<code>TV_OFF_THRESHOLD</code> と <code>TV_ON_BRIGHT_THRESHOLD</code> の二つを調整していくことになります。</p>
<p>パラメータの値の意味は <a href="https://docs.google.com/presentation/d/1eBG_fJIv4PCCXM73SuGIJuBD21-lSFTBDZObi-TPpR0/edit?usp=sharing" target="_blank">Google スライド</a> の図解と共に確認ください。</p>


      </google-codelab-step>
    
      <google-codelab-step label="SORACOM Lagoon でダッシュボードを作成する（有効化まで）" duration="10">
        <p>設定と設置が完了したら、蓄積されたデータを SORACOM Lagoon で活用していきます。</p>
<h3 is-upgraded>SORACOM Lagoon 用語解説</h3>
<p>ここで SORACOM Lagoon で使われる用語を解説します。</p>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>用語</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>意味</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>プラン</p>
</td><td colspan="1" rowspan="1"><p>SORACOM Lagoon の契約プランです。機能と料金が異なります。<a href="https://soracom.jp/services/lagoon/price/" target="_blank">SORACOM Lagoon のご利用料金</a>に機能や料金の比較表があります。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>メトリクス</p>
<p>(メトリック)</p>
</td><td colspan="1" rowspan="1"><p>データが格納されている先です。SORACOM Lagoon では以下の4つの中から選び、その中からノード(SIMや回線)を選択します。</p>
<ul>
<li>Air = SORACOM Air for セルラー</li>
<li>LoRa = SORACOM Air for LoRaWAN</li>
<li>Sigfox = SORACOM Air for Sigfox</li>
<li>Device = SORACOM Inventory デバイス</li>
</ul>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>データソース</p>
</td><td colspan="1" rowspan="1"><p>メトリクスの参照先です。SORACOM Lagoon では &#34;Harvest&#34; (= SORACOM Harvest) を選ぶとメトリクスが展開されます。 Grafana ではテスト用のランダムデータが表示されます。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>パネル</p>
</td><td colspan="1" rowspan="1"><p>パネルはデータを表示する領域です。データソースとメトリクスを指定すると、そのメトリクス(たとえばSIM)のデータをパネルで使えるようになります。</p>
<p>様々なパネルが存在します。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>ダッシュボード</p>
</td><td colspan="1" rowspan="1"><p>複数のパネルを束ねて「1枚の画面」にしたものがダッシュボードです。共有の単位となります。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>SORACOM Lagoon ユーザー</p>
<p>(Lagoon ユーザー)</p>
</td><td colspan="1" rowspan="1"><p>SORACOM Lagoon へログインするためのユーザー(IDとパスワードの組)</p>
<p>SORACOM ユーザコンソールへのログインとは異なるユーザ一覧となり、皆さん自身で登録・削除が可能です。ダッシュボードやパネルを編集できる「編集可能」と表示専用の「読み取り」の2段階の権限を設定できます。</p>
<p>作成可能数はプランによります。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>データリフレッシュ</p>
</td><td colspan="1" rowspan="1"><p>SORACOM Harvest から SORACOM Lagoon へデータが反映される事、もしくは反映タイミングとなります。反映タイミングはプランによります。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>アラート</p>
</td><td colspan="1" rowspan="1"><p>メトリクスのデータに対して条件を設定し、その条件を満たしたら通知を行う仕組みの事です。</p>
</td></tr>
</table>
<h2 is-upgraded><a href="https://console.soracom.io/" target="_blank">SORACOM ユーザーコンソール</a>の［Menu］&gt;［データ収集・蓄積・可視化］&gt;［SORACOM Lagoon］とクリックします。</h2>
<p class="image-container"><img style="width: 547.00px" src="img/df078d78ef3c64c9.png"></p>
<h2 is-upgraded>［SORACOM Lagoon の利用を開始する］をクリックします。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/4a10b1d6ed1f5cc0.png"></p>
<h2 is-upgraded>プランのうち［Free］を選択したあと［続行する］をクリックします。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/748cdbb71537788c.png"></p>
<h2 is-upgraded>SORACOM Lagoon ユーザーの初期ユーザーに設定するパスワードを入力した後、［利用開始］をクリックします。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/f2b324c51b7a071e.png"></p>
<aside class="special"><p><strong>SORACOM Lagoon ユーザーの初期ユーザの ID は？</strong></p>
<p>ID は SORACOM ユーザコンソールにログインしたときのメールアドレスが使われることになります。そのため、ここではパスワードのみ設定することになります。<strong>SORACOM ユーザコンソールへのログインとは異なるパスワードを設定する事を強くお勧めします。</strong></p>
</aside>
<aside class="warning"><p><strong>利用開始がクリックできない場合は？</strong></p>
<p>パスワードの条件が不足しています。全てに✔がつくようにパスワードを設定してください。</p>
</aside>
<p>SORACOM Lagoon の有効化に成功すると、以下のように SORACOM Lagoon コンソールへのリンクと、Lagoon ユーザーの一覧が管理できるようになります。</p>
<p>この画面を SORACOM Lagoon 管理画面と呼びます。</p>
<p class="image-container"><img style="width: 602.00px" src="img/6c91011f8fa4eb2.png"></p>
<p>SORACOM Lagoon 管理画面は、SORACOM Lagoon が有効化されている間は ［Menu］&gt;［データ収集・蓄積・可視化］&gt;［SORACOM Lagoon］で表示する事ができます。</p>


      </google-codelab-step>
    
      <google-codelab-step label="SORACOM Lagoon でダッシュボードを作成する（パネル作成 ～ アラート設定）" duration="20">
        <h2 is-upgraded>SORACOM Lagoon 管理画面を表示したあと、［SORACOM Lagoon console にアクセス］をクリックします。</h2>
<p>※ SORACOM Lagoon 管理画面は ［Menu］&gt;［データ収集・蓄積・可視化］&gt;［SORACOM Lagoon］で表示する事ができます。</p>
<p class="image-container"><img style="width: 602.00px" src="img/e056d4558913af2.png"></p>
<h2 is-upgraded>SORACOM Lagoon へログインします。</h2>
<p>メールアドレス (SORACOM ユーザコンソールへログインする際のメールアドレス) と、SORACOM Lagoon 初期ユーザ作成時に利用したパスワードでログインします。</p>
<p class="image-container"><img style="width: 602.00px" src="img/d442ea101d6ae875.png"></p>
<p>ログインに成功すると、以下のような画面が表示されます。これが SORACOM Lagoon ログイン直後の画面です。ここから「ダッシュボード」や「パネル」を作成していきます。</p>
<p class="image-container"><img style="width: 863.50px" src="img/44e0c42dbcc5e10a.png"></p>
<aside class="special"><p><strong>背景を白くしたい</strong></p>
<p>SORACOM Lagoon の標準では背景が黒となっています。これは設定で変更が可能です。</p>
<p>右下のアイコンにカーソルを合わせて表示される［設定］をクリックします。</p>
<p class="image-container"><img style="width: 342.00px" src="img/8cec8a9120d25dcd.png"></p>
<p>設定画面に &#34;テーマ&#34; を &#34;Light&#34; に変更して［保存］すると、背景が白くなります。</p>
<p class="image-container"><img style="width: 502.00px" src="img/69d5628454a7662a.png"></p>
</aside>
<h2 is-upgraded>アラート作成アイコン<img style="width: 42.00px" src="img/b32a9a5b5951b49c.png">にカーソルを乗せると表示される「作成」メニューから［通知チャンネル］をクリックし、その後表示される［チャンネルを追加］をクリックします。</h2>
<p class="image-container"><img style="width: 297.00px" src="img/af117aa0b9d789c5.png"></p>
<h2 is-upgraded><img style="width: 292.00px" src="img/99d2dc13bedafcf6.png"></h2>
<h2 is-upgraded>「新しい通知チャンネルを追加」では、以下のように設定します。</h2>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>設定値</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>備考</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>名前</p>
</td><td colspan="1" rowspan="1"><p><code>テレビの通知</code></p>
</td><td colspan="1" rowspan="1"><p>任意の名前が利用できます。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>タイプ</p>
</td><td colspan="1" rowspan="1"><p>Email</p>
</td><td colspan="1" rowspan="1"><p>Email となっていれば次に進みます。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Email addresses</p>
</td><td colspan="1" rowspan="1"><p>（通知の送信先 Email アドレス）</p>
</td><td colspan="1" rowspan="1"><p>通知の送信先アドレスを指定します。</p>
</td></tr>
</table>
<p class="image-container"><img style="width: 442.00px" src="img/e711df8e4d8c6b22.png"></p>
<p>ここまで入力が終わったら［送信テスト］をクリックします。「Email addresses」に記載したアドレスへ、以下のようなメールが届いていることを確認します。</p>
<p class="image-container"><img style="width: 602.00px" src="img/20ce666398a775bd.png"></p>
<p>テストの結果が良好であれば、SORACOM Lagoon の画面に戻り［保存］をクリックします。</p>
<h2 is-upgraded><img style="width: 442.00px" src="img/45410f4db99bdf90.png"></h2>
<h2 is-upgraded>作成アイコン<img style="width: 40.00px" src="img/940a7161e06b7174.png">にカーソルを乗せると表示される「作成」メニューから［ダッシュボード］をクリックします。</h2>
<p class="image-container"><img style="width: 297.00px" src="img/3efe197697d950a1.png"></p>
<h2 is-upgraded>［Graph］ をクリックします。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/c3360800d3def06.png"></p>
<aside class="special"><p>ダッシュボードが新規作成されると、最初のパネルも自動的にされます。パネルを追加したい場合は画面右上の<img style="width: 271.00px" src="img/ba6e7c6ec8c48277.png">で新たなパネルを追加できます。</p>
</aside>
<h2 is-upgraded>&#34;Panel Title&#34; &gt;［編集］をクリックします。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/78d86dcd59a18a6e.png"></p>
<h2 is-upgraded>&#34;メトリック&#34; タブでノード(= SIM) をクリックし、Wio LTE に取り付けている SIM を選びます。</h2>
<p>データソースは &#34;default&#34; に、メトリクスは &#34;Air&#34; になっているので、あとはノード(= SIM) を選びます。</p>
<p class="image-container"><img style="width: 602.00px" src="img/98a51162b71e3ac5.png"></p>
<p>選んだ時点で、全データが表示されます。</p>
<aside class="special"><p><strong>データが表示されていない？</strong></p>
<p>データを蓄積し始めてから間もない場合、グラフの右端に「少しだけ」表示されている場合があります。これは、パネルの表示時間の標準が「過去6時間分」を表示するようになっているからです。</p>
<p class="image-container"><img style="width: 803.50px" src="img/d49a60ead1e9e525.png"></p>
<p>右上の「時間」ボタンで表示範囲を設定可能です。まずは「過去15分間」くらいが良いでしょう。</p>
<p class="image-container"><img style="width: 587.00px" src="img/76a64d941a095f3.png"></p>
<p>それでもデータが表示されていない場合は、いったん SORACOM Harvest Data データの蓄積具合を確認するようにしてください。</p>
</aside>
<h2 is-upgraded>表示データを &#34;clickType&#34; のみにします。</h2>
<p>データの項目リストをクリックして &#34;power_on_rate&#34; をクリックします。</p>
<p class="image-container"><img style="width: 739.14px" src="img/dc18e964a88764fd.png"></p>
<p>選ぶと、即時グラフに反映されます。</p>
<h2 is-upgraded>右上の保存ボタン<img style="width: 33.00px" src="img/6780dfe4cd33f2a0.png">をクリックし、表示されたダイアログでダッシュボード名を入力した上で［保存］をクリックします。</h2>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>設定値</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>備考</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>名前</p>
</td><td colspan="1" rowspan="1"><p>テレビのON/OFF状況</p>
</td><td colspan="1" rowspan="1"><p>任意の名前が利用できます。</p>
</td></tr>
</table>
<p class="image-container"><img style="width: 513.00px" src="img/edd9af0839b0b576.png"></p>
<h2 is-upgraded>ダッシュボードに戻るので、再度 &#34;Panel Title&#34; &gt;［編集］をクリックします。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/78d86dcd59a18a6e.png"></p>
<h2 is-upgraded>&#34;アラート&#34; タブをクリックした後、［アラートの作成］をクリックします。</h2>
<p class="image-container"><img style="width: 602.00px" src="img/1dba07519807ce.png"></p>
<h2 is-upgraded>「アラート設定」を以下の通りに設定します。</h2>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>設定値</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>備考</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>名前</p>
</td><td colspan="1" rowspan="1"><p><code>テレビのON/OFF状況 Alert</code></p>
</td><td colspan="1" rowspan="1"><p>任意の名前が利用できます。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>評価間隔</p>
</td><td colspan="1" rowspan="1"><p><code>60s</code></p>
</td><td colspan="1" rowspan="1"><p>閾値の監視間隔です。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>条件 (WHEN)</p>
</td><td colspan="1" rowspan="1"><p><code>avg()</code></p>
</td><td colspan="1" rowspan="1"><p>&#34;avg()&#34; になっていることを確認します。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>条件 (OF)</p>
</td><td colspan="1" rowspan="1"><p><code>query(A, 1m, now)</code></p>
</td><td colspan="1" rowspan="1"><p>&#34;5m&#34; をクリックすると一覧が現れます。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>条件 (IS ABOVE)</p>
</td><td colspan="1" rowspan="1"><p><code>0.25</code></p>
</td><td colspan="1" rowspan="1"><p>&#34;IS ABOVE&#34; はそれ自体の条件の &#34;IS BELOW&#34;<br>(=以下)等に変更することができます。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>データが無いか全ての値が Null の時</p>
</td><td colspan="1" rowspan="1"><p><code>No Data</code></p>
</td><td colspan="1" rowspan="1"><p>変更の必要はありません。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>実行エラーまたはタイムアウトの時</p>
</td><td colspan="1" rowspan="1"><p><code>Alerting</code></p>
</td><td colspan="1" rowspan="1"><p>変更の必要はありません。</p>
</td></tr>
</table>
<p class="image-container"><img style="width: 602.00px" src="img/219cb838231aad63.png"></p>
<aside class="special"><p><strong>設定内容の意味は？</strong></p>
<ul>
<li><code>avg()</code> は、条件(OF) で設定した期間内における平均値です。</li>
<li><code>query(A, 1m, now)</code> は、「メトリックの &#34;A&#34; を対象に、 1m から now までの間」となります。</li>
</ul>
<p>合わせると、メトリック &#34;A&#34; すなわち、光センサーの値を対象に、過去 <code>1m</code>(分) から <code>now</code>(現在) における最後の値が <code>0.25</code> 以上（の時はアラート発生）という意味になります。</p>
</aside>
<p>ここまで入力が完了できたら［ルールを確認］をクリックします。この時点でTV が暗い状態でデータが何度か送信されて、平均値が 0.25 が下回っていれば  <code>firing: false</code> 即ち、アラートは発生せず、正常な設定となります。</p>
<p class="image-container"><img style="width: 268.00px" src="img/912d9bf6fb0c3838.png"></p>
<p>次に、TV が明るい状態でデータを発生させます。30秒～60秒経過した後に、再度［ルールを確認］をクリックすると <code>firing: true</code> 即ち、アラートが発生した状態となります。（この時点では通知の送信先を設定していないため、アラート発生の有無を確認するのみとなります。）</p>
<p class="image-container"><img style="width: 266.00px" src="img/47407b00b4337b96.png"></p>
<p>そこから30秒～60秒経過した後に、再度［ルールを確認］をクリックすると <code>firing: false</code> に戻ることが確認できるでしょう。</p>
<p>［ルールを確認］ボタンは何度でも押すことが可能ですので、何度か試してみることをお勧めいたします。</p>
<h2 is-upgraded>［通知］をクリックした後、 &#34;送り先&#34; の追加 <img style="width: 40.00px" src="img/8366db64ed0d3c95.png"> をクリックします。一覧の中から通知チャンネルで作成した通知先をクリックします。</h2>
<p>本レシピでは &#34;開閉の通知&#34; という名称で作ったので、それをクリックします。</p>
<p class="image-container"><img style="width: 602.00px" src="img/2f8ab94c75e663c0.png"></p>
<h2 is-upgraded>&#34;メッセージ&#34; にアラート発生時のメッセージを入力します。</h2>
<p>ここではテレビがつけっぱなしであることを通知するメッセージを入力しています。</p>
<p class="image-container"><img style="width: 408.00px" src="img/8302ccf7ff0c9bc1.png"></p>
<h2 is-upgraded>右上の保存ボタン<img style="width: 33.00px" src="img/6780dfe4cd33f2a0.png">をクリックし、［保存］をクリックします。</h2>
<p>以上で全ての設定が終了しました。画面右上のダッシュボードに戻る<img style="width: 54.00px" src="img/2c69286f16fd7716.png">ボタンをクリックし、ダッシュボードに戻ります。</p>


      </google-codelab-step>
    
      <google-codelab-step label="アラートのメールを確認する" duration="10">
        <p>実際にTVを ON にしてみて通知が来るか試してみましょう。以下のようなメールが届きます。</p>
<p class="image-container"><img style="width: 602.00px" src="img/5e27d1efc121db00.png"></p>
<p>頻度を上げたい場合は、SORACOM Lagoon の有料プランをご検討ください。また、評価間隔や条件を調整することで、「TV がついてから2時間後に通知」といった仕組みも可能です。詳細は<a href="https://soracom.zendesk.com/hc/ja/articles/360028531812" target="_blank">SORACOM Lagoon のアラートがトリガーされないことがある</a>をご覧ください。</p>


      </google-codelab-step>
    
      <google-codelab-step label="あとかたづけと注意事項" duration="1">
        <p>本レシピでは費用がかかるサービスを利用しています。<br>本項をよく読み、必要な操作や解除作業を行うようにして、想定外の費用が掛からないようにしてください。</p>
<h2 is-upgraded>費用について</h2>
<p>ここで記載している金額は全て税別、送料別となります。</p>
<h3 is-upgraded>SORACOM プラットフォームの利用料金</h3>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>サービス／機能</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>料金</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><a href="https://soracom.jp/services/air/cellular/price_specific_area_sim/" target="_blank">SORACOM Air (plan-D)</a></p>
</td><td colspan="1" rowspan="1"><p>基本料: 10円/日</p>
<p>通信料: 0.2円~/MB</p>
<p>(今回の利用であれば 1MB 以内で収まる範囲)</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><a href="https://soracom.jp/services/harvest/price/" target="_blank">SORACOM Harvest Data</a></p>
</td><td colspan="1" rowspan="1"><p>本機能を有効にしたグループに所属する1SIMあたり5円/日 (2000リクエスト/日/SIMを含む)</p>
<p>2000リクエスト/日を超えた分は0.004円/リクエスト</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><a href="https://soracom.jp/services/lagoon/price/" target="_blank">SORACOM Lagoon</a></p>
</td><td colspan="1" rowspan="1"><p>本レシピでは Free プラン(無料)を使用しました。その他の有料プランで出来るようになること等は <a href="https://soracom.jp/services/lagoon/price/" target="_blank">SORACOM Lagoon 利用料金のページ</a>をご覧ください。</p>
</td></tr>
</table>
<p>※ 費用詳細はリンク先をご確認ください。</p>
<aside class="special"><p><strong>無料利用枠について</strong></p>
<p>SORACOM サービスでは一部サービスにおいて無料枠が設定されています。たとえば SORACOM Air for セルラーであればアカウント毎で30円/月の通信分や、SORACOM Harvest Data であれば31日分の書込みリクエストなどです。料金詳細に「無料利用枠」として掲載されていますので、ご確認ください。</p>
</aside>
<h2 is-upgraded>グループ解除</h2>
<p>SORACOM Harvest Data 等、「機能が有効になっているグループに所属している SIM × 費用」となっているサービスにおいては、「機能を OFF にする」することで費用の発生を抑えることができます。またもう1つの方法として「グループに所属している SIM の数を減らす(= 解除する)」事でも費用を抑える事ができます。</p>
<p>グループ解除の方法は<a href="https://soracom.github.io/iot-recipes/unjoin-from-group/" target="_blank">グループからの解除 (JP)</a>をご覧ください。</p>
<h2 is-upgraded>SORACOM Harvest Data のデータ削除</h2>
<p>SORACOM Harvest Data は基本的にはデータ保管料は無料※です。そのため、保存しておいても害はありませんが、デモ等で利用する際にはデータを綺麗にしておく必要が出てくるため、データ削除について解説します。</p>
<p>※発生から40日を超えたデータは削除されます。40日以上データを保管したい場合は<a href="https://soracom.jp/services/harvest/price/" target="_blank">データ保持期間延長オプション利用料金</a>をご利用ください。</p>
<p>SORACOM Harvest Data 画面 (［操作］&gt;［データを確認］) のデータテーブルで、削除したいデータのチェックボックスを付けた後に［削除］をクリックします。表示されたダイアログで改めて［削除］をクリックすると、削除されます。<br>※ 複数のデータにチェックをつければ一括で削除可能です。</p>
<p class="image-container"><img style="width: 414.00px" src="img/637cac3bf206c47c.png"></p>
<p><strong>データの復元はできません</strong>のでご注意ください。</p>
<h2 is-upgraded>SORACOM Lagoon の解約</h2>
<p>SORACOM Lagoon はオンラインで解約が可能です。 Free プランであれば有効化しておいても費用は発生しませんが、長期に渡って利用しない場合には解約も選択いただけます。</p>
<p>解約の方法は<a href="https://soracom.github.io/iot-recipes/disable-soracom-lagoon" target="_blank">SORACOM Lagoon の解約(JP)</a>をご覧ください。</p>


      </google-codelab-step>
    
      <google-codelab-step label="次のステップ" duration="1">
        <p>本レシピでは、光センサーモジュールを利用して「テレビの ON/OFF」の判定を行う仕組みを作りました。光るものであれば応用が可能ですので、ご家庭内、もしくはオフィスで探してみてください。また、データの送信先は SORACOM Harvest Data とデータ活用は SORACOM Lagoon としましたが、SORACOM Beam / SORACOM Funnel / SORACOM Funk を利用することで通知のバリエーションを増やしたり、他の機器を動かすといった事も可能となります。</p>
<p><a href="https://soracom.jp/products/kit/grovestarter_kit_lte/" target="_blank">商品ページへ戻る</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="Appendix: スケッチ解説" duration="1">
        <h2 is-upgraded>ノイズの除去</h2>
<p>センサーによるセンシングには「ノイズ」が入ることは避けられないため、センシングした値に対してなんらかの操作（フィルタ等）を行う必要があります。</p>
<p>今回は、以下のようなノイズが考えられます。</p>
<ul>
<li>周囲の環境光（カバーでは完全な遮蔽は難しい）</li>
<li>TV の放映内容（映画番組でありがちな暗めのシーン等）</li>
</ul>
<p>対処は様々考えられますが、今回おこなった手法は「計測期間内において &#34;画面が暗かった割合&#34;」をデバイスで算出しています。</p>
<p class="image-container"><img style="width: 795.60px" src="img/76ee6c3f51adc86.png"></p>
<p>この割合に対して「~%以上だったら TV が ON になっているとみなす」と算出するわけですが、これをデバイス上では無くクラウド上で行ています。これは、「~%以上だったら」の部分は環境によって異なるため、調整がしやすいクラウドの方が有利だからです。</p>
<p class="image-container"><img style="width: 791.50px" src="img/ba94833f313585c8.png"></p>
<p>※ 資料は <a href="https://docs.google.com/presentation/d/1r4-1JVoa9pIiQ9UIMzC1Y5OxFwaBU-NeVeV30W3hEy8/edit?usp=sharing" target="_blank">Google スライド</a> でも見ることができます。</p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://soracom.github.io/iot-recipes/codelab-elements/native-shim.js"></script>
  <script src="https://soracom.github.io/iot-recipes/codelab-elements/custom-elements.min.js"></script>
  <script src="https://soracom.github.io/iot-recipes/codelab-elements/prettify.js"></script>
  <script src="https://soracom.github.io/iot-recipes/codelab-elements/codelab-elements.js"></script>

</body>
</html>
